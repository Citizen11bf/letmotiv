<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Simulateur d'improvisation</title>
  <meta name="description" content="Évaluer et développer sa prise de parole en public avec le simulateur d'improvisation Letmotiv. Entreprise spécialisée dans le coaching en prise de parole.">

  <!-- Icône de la page (favicon) -->
  <link rel="icon" href="https://raw.githubusercontent.com/Citizen11bf/letmotiv/refs/heads/images/Letmotiv_favicon.webp" type="image/png">
  <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/Citizen11bf/letmotiv/refs/heads/images/Letmotiv_favicon.webp">
  
  <!-- Balises Open Graph pour LinkedIn -->
  <meta property="og:title" content="Simulateur d'improvisation Letmotiv" />
  <meta property="og:description" content="Évaluer et développer sa prise de parole en public avec le simulateur d'improvisation Letmotiv." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://letmotiv-simulateur.fr" />
  <meta property="og:image" content="https://i.postimg.cc/LXxJLTVx/Letmotiv-og-image.png" />
  <meta property="og:image:alt" content="Illustration d'une improvisation en public avec un orateur sur scène." />
  <meta name="author" content="Simulateur d'improvisation Letmotiv" />
  <meta property="article:published_time" content="2025-01-26" />

  <!-- Balises Twitter (optionnel) -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Simulateur d'improvisation Letmotiv">
  <meta name="twitter:description" content="Évaluer et développer sa prise de parole en public avec le simulateur d'improvisation Letmotiv.">
  <meta name="twitter:image" content="https://i.postimg.cc/LXxJLTVx/Letmotiv-og-image.png">

  <!-- Import de la police DM Sans et Montserrat depuis Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans&family=Montserrat:wght@700&display=swap" rel="stylesheet" />

  <!-- Icônes Font Awesome (pour les autres éléments si besoin) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />

  <!-- JSON-LD pour le SEO -->
  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "Simulateur d'improvisation Letmotiv",
      "url": "https://letmotiv-simulateur.fr",
      "description": "Évaluer et développer sa prise de parole en public avec le simulateur d'improvisation Letmotiv.",
      "publisher": {
        "@type": "Organization",
        "name": "Letmotiv",
        "logo": "https://letmotiv-simulateur.fr/logo.png"
      }
    }
  </script>
  
  <!-- Styles CSS -->
  <style>
    /* --- GLOBAL --- */
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'DM Sans', sans-serif;
      background-color: #ffffff;
      color: #333333;
      padding-top: 60px; /* espace pour le header fixe */
      padding-bottom: 20px;
    }

    /* --- HEADER --- */
    .header {
      background-color: #182d84;
      color: #FFFFFF;
      font-size: 16px;
      font-weight: bold;
      text-align: center;
      padding: 10px;
      width: 100%;
      position: fixed;
      top: 0;
      left: 0;
      z-index: 10;
    }
    .header-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 5px;
      max-width: 100%;
      overflow-wrap: break-word;
    }
    .header-l2 { font-size: 14px; font-weight: normal; }

    /* --- BARRE DE PROGRESSION --- */
    .progress-container {
      position: fixed;
      top: 60px;
      left: 0;
      width: 100%;
      height: 10px;
      background-color: rgba(24, 45, 132, 0.1);
      z-index: 9;
    }
    .progress-bar {
      width: 0%;
      height: 100%;
      background-color: #00a48a;
      transition: width 0.5s ease;
    }

    /* --- Boutons CTA personnalisés (basés sur styled-components) --- */
    .cta {
      display: inline-flex;
      align-items: center;
      padding: 11px 33px;
      text-decoration: none;
      font-size: 25px;
      color: white;
      background: #6225e6;
      transition: 1s;
      box-shadow: 6px 6px 0 black;
      transform: skewX(-15deg);
      border: none;
      cursor: pointer;
    }
    .cta:focus { outline: none; }
    .cta:hover { transition: 0.5s; box-shadow: 10px 10px 0 #fbc638; }
    .cta .span { transform: skewX(15deg); }
    .cta .second {
      transition: 0.5s;
      margin-left: 30px;
      position: relative;
      top: 12%;
    }
    .cta:hover .second { margin-right: 45px; }
    .cta .one { transition: 0.4s; transform: translateX(-60%); }
    .cta .two { transition: 0.5s; transform: translateX(-30%); }
    .cta:hover .three { animation: color_anim 1s infinite 0.2s; }
    .cta:hover .one { transform: translateX(0%); animation: color_anim 1s infinite 0.6s; }
    .cta:hover .two { transform: translateX(0%); animation: color_anim 1s infinite 0.4s; }
    @keyframes color_anim {
      0% { fill: white; }
      50% { fill: #fbc638; }
      100% { fill: white; }
    }

    /* --- Boutons de navigation NEXT & BACK --- */
    /* On utilise les classes .next-btn et .back-btn pour distinguer les boutons */
    /* Exemple pour le bouton "Suivant" */
    .next-btn {
      /* Les styles communs sont hérités de .cta */
    }
    /* Pour le bouton "Retour", on inverse l'ordre du contenu et on applique la transformation sur le SVG */
    .back-btn {
      display: inline-flex;
      align-items: center;
      padding: 11px 33px;
      text-decoration: none;
      font-size: 25px;
      color: white;
      background: #6225e6;
      transition: 1s;
      box-shadow: 6px 6px 0 black;
      transform: skewX(-15deg);
      border: none;
      cursor: pointer;
    }
    .back-btn:focus { outline: none; }
    .back-btn:hover { transition: 0.5s; box-shadow: 10px 10px 0 #fbc638; }
    .back-btn .span { transform: skewX(15deg); }
    .back-btn .second {
      transition: 0.5s;
      margin-right: 30px;
      position: relative;
      top: 12%;
      /* Inversion du SVG */
      transform: scaleX(-1);
    }
    .back-btn:hover .second { margin-left: 45px; }

    /* --- BOÎTE D'INTRODUCTION --- */
    .intro-box {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: linear-gradient(135deg, #182d84, #00a48a);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      color: #ffffff;
      z-index: 20;
      animation: fadeIn 1s ease forwards;
    }
    .intro-box h1 {
      font-family: 'Montserrat', sans-serif;
      font-size: 2.5rem;
      margin-bottom: 30px;
      animation: slideDown 1s ease forwards;
    }
    .intro-box button {
      background-color: #ffffff;
      color: #182d84;
      font-family: 'DM Sans', sans-serif;
      font-size: 1.2rem;
      border: none;
      border-radius: 25px;
      padding: 15px 30px;
      cursor: pointer;
      transition: background-color 0.3s, transform 0.3s, color 0.3s;
      box-shadow: 0px 4px 6px rgba(0,0,0,0.2);
    }
    .intro-box button:hover {
      background-color: #00a48a;
      color: #ffffff;
      transform: scale(1.05);
    }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } }
    @keyframes slideDown { from { transform: translateY(-50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

    /* --- CONTENEUR PRINCIPAL --- */
    .main-container {
      position: relative;
      padding: 20px;
    }

    /* --- BOXES (étapes) --- */
    .box {
      position: relative;
      width: 100%;
      max-width: 600px;
      margin: 20px auto;
      padding: 20px;
      border-radius: 15px;
      background: linear-gradient(135deg, #ffffff, #f9f9f9);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      text-align: center;
      font-size: 14px;
      display: none;
      transition: opacity 0.5s ease;
    }
    .box.active { display: block; opacity: 1; }
    .box.hidden { opacity: 0; }

    /* --- ANIMATIONS VERTICALES --- */
    .slide-from-bottom { animation: fromBottom 1.5s ease forwards; }
    @keyframes fromBottom { from { opacity: 0; transform: translateY(50px); } to { opacity: 1; transform: translateY(0); } }
    .slide-from-top { animation: fromTop 1.5s ease forwards; }
    @keyframes fromTop { from { opacity: 0; transform: translateY(-50px); } to { opacity: 1; transform: translateY(0); } }

    /* --- HEADER INTERNE DES BOXES --- */
    .box-header {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      margin-bottom: 20px;
      position: relative;
    }
    /* Les anciens styles des boutons back/next sont remplacés par les nouveaux boutons .cta */
    /* --- Reste du CSS d'origine... (le code existant est conservé tel quel) --- */
    
    /* ... (le reste de votre CSS d'origine demeure inchangé) ... */
    
    /* --- MEDIA QUERIES --- */
    @media (max-width: 600px) {
      h1 .line { display: block; }
      .objectives-container {
        display: flex;
        flex-direction: column;
        gap: 12px;
        padding: 0 5px;
        margin: 10px auto;
        box-sizing: border-box;
      }
      .objective-item {
        position: relative;
        display: flex;
        justify-content: space-between;
        align-items: center; 
        background-color: #f0f1f5;
        border-radius: 10px;
        padding: 14px 20px 14px 14px; 
        width: 100%;
        box-sizing: border-box;
        font-size: 1rem;
        font-family: 'DM Sans', sans-serif;
        color: #333;
        cursor: pointer;
        transition: background-color 0.3s, transform 0.2s;
        border: none;
      }
      .objective-item i {
        position: absolute;
        bottom: 0px;
        right: 10px;
        font-size: 2.0rem;
        color: #444;
      }
      .objective-item:nth-child(odd) i {
        transform: rotate(-10deg);
      }
      .objective-item:nth-child(even) i {
        transform: rotate(10deg);
      }
      .objective-item:hover {
        background-color: #e5e7eb;
        transform: translateY(-1px);
      }
      .objective-item:active {
        transform: translateY(0);
        background-color: #dcdfe3;
      }
      .mobile-explanation {
        font-size: 0.8rem;
        color: #555;
        font-weight: bold;
        margin: 4px 10px 8px;
        text-align: left;
      }
    }
    
    @media (min-width: 601px) {
      .main-container {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: calc(100vh - 60px);
      }
      .box {
        position: relative;
        margin: 0 auto;
      }
      .objectives-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 20px;
        margin: 20px 0;
        padding: 0 10px;
        max-width: 600px;
        margin-left: auto;
        margin-right: auto;
      }
      .objective-item {
        background-color: #f7f9fc;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        border-radius: 8px;
        transition: transform 0.3s, background-color 0.3s, color 0.3s;
        flex: 1 1 150px;
        text-align: center;
      }
      .objective-item i {
        color: #777;
        transition: color 0.3s;
      }
      .objective-item:hover {
        transform: scale(1.03);
        background-color: #00a48a;
      }
      .objective-item:hover i {
        color: #fff;
      }
      .objective-item:hover span {
        color: #fff;
      }
    }
    
    @keyframes fadeInDown { from { transform: translateY(-20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
  </style>
</head>
<body>
  
  <!-- BOÎTE D'INTRODUCTION -->
  <div class="intro-box" id="intro-box">
    <h1>
      <span class="line">Entraîne-toi</span>
      <span class="line">à la prise de</span>
      <span class="line">parole en public</span>
    </h1> 
    <button id="start-intro-btn" aria-label="Commencer">Commencer</button>
  </div>

  <!-- FORMULAIRE CACHÉ POUR GOOGLE FORMS -->
  <form id="hidden-google-form"
        action="https://docs.google.com/forms/d/e/1FAIpQLSfGAcKp0cV5AeVJCJBPbtKLKCLhbYySZf_FkiMg85WKVFUn6A/formResponse"
        method="POST"
        target="hidden_iframe"
        style="display:none;">
    <input type="text" name="entry.1119647353" id="hidden-prenom">
    <input type="email" name="entry.638831312" id="hidden-email">
  </form>
  <iframe name="hidden_iframe" id="hidden_iframe" style="display:none;"></iframe>

  <!-- HEADER -->
  <div class="header">
    <div class="header-content">
      <div class="header-l1">Coaching en prise de parole</div>
      <div class="header-l2">Simulateur d'improvisation Letmotiv</div>
    </div>
  </div>

  <!-- BARRE DE PROGRESSION -->
  <div class="progress-container">
    <div class="progress-bar" id="top-progress-bar"></div>
  </div>

  <!-- CONTAINER PRINCIPAL -->
  <div class="main-container">
    <!-- Les étapes du simulateur -->

    <!-- STEP1 : Choix d'objectif -->
    <div class="box" id="step1">
      <div class="box-header">
        <!-- Bouton Retour (invisible en STEP1, on peut conserver la classe hidden-visibility si besoin) -->
        <button class="cta back-btn hidden-visibility" id="back-btn1" aria-label="Retour">
          <span class="second">
            <svg width="50px" height="20px" viewBox="0 0 66 43" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlnsXlink="http://www.w3.org/1999/xlink">
              <g id="arrow" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                <path class="one" d="M40.1543933,3.89485454 L43.9763149,0.139296592 C44.1708311,-0.0518420739 44.4826329,-0.0518571125 44.6771675,0.139262789 L65.6916134,20.7848311 C66.0855801,21.1718824 66.0911863,21.8050225 65.704135,22.1989893 C65.7000188,22.2031791 65.6958657,22.2073326 65.6916762,22.2114492 L44.677098,42.8607841 C44.4825957,43.0519059 44.1708242,43.0519358 43.9762853,42.8608513 L40.1545186,39.1069479 C39.9575152,38.9134427 39.9546793,38.5968729 40.1481845,38.3998695 C40.1502893,38.3977268 40.1524132,38.395603 40.1545562,38.3934985 L56.9937789,21.8567812 C57.1908028,21.6632968 57.193672,21.3467273 57.0001876,21.1497035 C56.9980647,21.1475418 56.9959223,21.1453995 56.9937605,21.1432767 L40.1545208,4.60825197 C39.9574869,4.41477773 39.9546013,4.09820839 40.1480756,3.90117456 C40.1501626,3.89904911 40.1522686,3.89694235 40.1543933,3.89485454 Z" fill="#FFFFFF" />
                <path class="two" d="M20.1543933,3.89485454 L23.9763149,0.139296592 C24.1708311,-0.0518420739 24.4826329,-0.0518571125 24.6771675,0.139262789 L45.6916134,20.7848311 C46.0855801,21.1718824 46.0911863,21.8050225 45.704135,22.1989893 C45.7000188,22.2031791 45.6958657,22.2073326 45.6916762,22.2114492 L24.677098,42.8607841 C24.4825957,43.0519059 24.1708242,43.0519358 23.9762853,42.8608513 L20.1545186,39.1069479 C19.9575152,38.9134427 19.9546793,38.5968729 20.1481845,38.3998695 C20.1502893,38.3977268 20.1524132,38.395603 20.1545562,38.3934985 L36.9937789,21.8567812 C37.1908028,21.6632968 37.193672,21.3467273 37.0001876,21.1497035 C36.9980647,21.1475418 36.9959223,21.1453995 36.9937605,21.1432767 L20.1545208,4.60825197 C19.9574869,4.41477773 19.9546013,4.09820839 20.1480756,3.90117456 C20.1501626,3.89904911 20.1522686,3.89694235 20.1543933,3.89485454 Z" fill="#FFFFFF" />
                <path class="three" d="M0.154393339,3.89485454 L3.97631488,0.139296592 C4.17083111,-0.0518420739 4.48263286,-0.0518571125 4.67716753,0.139262789 L25.6916134,20.7848311 C26.0855801,21.1718824 26.0911863,21.8050225 25.704135,22.1989893 C25.7000188,22.2031791 25.6958657,22.2073326 25.6916762,22.2114492 L4.67709797,42.8607841 C4.48259567,43.0519059 4.17082418,43.0519358 3.97628526,42.8608513 L0.154518591,39.1069479 C-0.0424848215,38.9134427 -0.0453206733,38.5968729 0.148184538,38.3998695 C0.150289256,38.3977268 0.152413239,38.395603 0.154556228,38.3934985 L16.9937789,21.8567812 C17.1908028,21.6632968 17.193672,21.3467273 17.0001876,21.1497035 C16.9980647,21.1475418 16.9959223,21.1453995 16.9937605,21.1432767 L0.15452076,4.60825197 C-0.0425130651,4.41477773 -0.0453986756,4.09820839 0.148075568,3.90117456 C0.150162624,3.89904911 0.152268631,3.89694235 0.154393339,3.89485454 Z" fill="#FFFFFF" />
              </g>
            </svg>
          </span>
          <span class="span">RETOUR</span>
        </button>
        <div class="box-title">Quel est ton objectif ?</div>
      </div>
      <div class="objectives-container">
        <div class="objective-item" data-category="diction">
          <i class="fas fa-grin-tongue"></i>
          <span>Améliorer sa diction</span>
        </div>
        <div class="objective-item" data-category="repartie">
          <i class="fas fa-comments"></i>
          <span>Avoir de la répartie</span>
        </div>
        <div class="objective-item" data-category="convaincre">
          <i class="fas fa-handshake"></i>
          <span>Convaincre</span>
        </div>
        <div class="objective-item" data-category="conflit">
          <i class="fas fa-exclamation-triangle"></i>
          <span>Gérer un conflit</span>
        </div>
        <div class="objective-item" data-category="inspirer">
          <i class="fas fa-lightbulb"></i>
          <span>Inspirer</span>
        </div>
        <div class="objective-item" data-category="lacher-prise">
          <i class="fas fa-smile"></i>
          <span>Lâcher prise</span>
        </div>
        <div class="objective-item" data-category="toast">
          <i class="fas fa-glass-cheers"></i>
          <span>Porter un toast</span>
        </div>
        <div class="objective-item" data-category="entretien">
          <i class="fas fa-briefcase"></i>
          <span>Réussir son entretien</span>
        </div>
        <div class="objective-item" data-category="vendre">
          <i class="fas fa-money-bill-wave"></i>
          <span>Vendre</span>
        </div>
      </div>
      <div id="explanation-box" class="explanation-box"></div>
      <div id="objective-error" class="error-message"></div>
      <!-- Bouton Suivant -->
      <button class="cta next-btn" id="next-btn1" aria-label="Étape suivante">
        <span class="span">SUIVANT</span>
        <span class="second">
          <svg width="50px" height="20px" viewBox="0 0 66 43" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlnsXlink="http://www.w3.org/1999/xlink">
            <g id="arrow" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
              <path class="one" d="M40.1543933,3.89485454 L43.9763149,0.139296592 C44.1708311,-0.0518420739 44.4826329,-0.0518571125 44.6771675,0.139262789 L65.6916134,20.7848311 C66.0855801,21.1718824 66.0911863,21.8050225 65.704135,22.1989893 C65.7000188,22.2031791 65.6958657,22.2073326 65.6916762,22.2114492 L44.677098,42.8607841 C44.4825957,43.0519059 44.1708242,43.0519358 43.9762853,42.8608513 L40.1545186,39.1069479 C39.9575152,38.9134427 39.9546793,38.5968729 40.1481845,38.3998695 C40.1502893,38.3977268 40.1524132,38.395603 40.1545562,38.3934985 L56.9937789,21.8567812 C57.1908028,21.6632968 57.193672,21.3467273 57.0001876,21.1497035 C56.9980647,21.1475418 56.9959223,21.1453995 56.9937605,21.1432767 L40.1545208,4.60825197 C39.9574869,4.41477773 39.9546013,4.09820839 40.1480756,3.90117456 C40.1501626,3.89904911 40.1522686,3.89694235 40.1543933,3.89485454 Z" fill="#FFFFFF" />
              <path class="two" d="M20.1543933,3.89485454 L23.9763149,0.139296592 C24.1708311,-0.0518420739 24.4826329,-0.0518571125 24.6771675,0.139262789 L45.6916134,20.7848311 C46.0855801,21.1718824 46.0911863,21.8050225 45.704135,22.1989893 C45.7000188,22.2031791 45.6958657,22.2073326 45.6916762,22.2114492 L24.677098,42.8607841 C24.4825957,43.0519059 24.1708242,43.0519358 23.9762853,42.8608513 L20.1545186,39.1069479 C19.9575152,38.9134427 19.9546793,38.5968729 20.1481845,38.3998695 C20.1502893,38.3977268 20.1524132,38.395603 20.1545562,38.3934985 L36.9937789,21.8567812 C37.1908028,21.6632968 37.193672,21.3467273 37.0001876,21.1497035 C36.9980647,21.1475418 36.9959223,21.1453995 36.9937605,21.1432767 L20.1545208,4.60825197 C19.9574869,4.41477773 19.9546013,4.09820839 20.1480756,3.90117456 C20.1501626,3.89904911 20.1522686,3.89694235 20.1543933,3.89485454 Z" fill="#FFFFFF" />
              <path class="three" d="M0.154393339,3.89485454 L3.97631488,0.139296592 C4.17083111,-0.0518420739 4.48263286,-0.0518571125 4.67716753,0.139262789 L25.6916134,20.7848311 C26.0855801,21.1718824 26.0911863,21.8050225 25.704135,22.1989893 C25.7000188,22.2031791 25.6958657,22.2073326 25.6916762,22.2114492 L4.67709797,42.8607841 C4.48259567,43.0519059 4.17082418,43.0519358 3.97628526,42.8608513 L0.154518591,39.1069479 C-0.0424848215,38.9134427 -0.0453206733,38.5968729 0.148184538,38.3998695 C0.150289256,38.3977268 0.152413239,38.395603 0.154556228,38.3934985 L16.9937789,21.8567812 C17.1908028,21.6632968 17.193672,21.3467273 17.0001876,21.1497035 C16.9980647,21.1475418 16.9959223,21.1453995 16.9937605,21.1432767 L0.15452076,4.60825197 C-0.0425130651,4.41477773 -0.0453986756,4.09820839 0.148075568,3.90117456 C0.150162624,3.89904911 0.152268631,3.89694235 0.154393339,3.89485454 Z" fill="#FFFFFF" />
            </g>
          </svg>
        </span>
      </button>
    </div>

    <!-- STEP2 : Génération du sujet -->
    <div class="box" id="step2">
      <div class="box-header">
        <!-- Bouton Retour -->
        <button class="cta back-btn" id="back-btn2" aria-label="Retour à l'étape précédente">
          <span class="second">
            <svg width="50px" height="20px" viewBox="0 0 66 43" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlnsXlink="http://www.w3.org/1999/xlink">
              <g id="arrow" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                <path class="one" d="M40.1543933,3.89485454 L43.9763149,0.139296592 C44.1708311,-0.0518420739 44.4826329,-0.0518571125 44.6771675,0.139262789 L65.6916134,20.7848311 C66.0855801,21.1718824 66.0911863,21.8050225 65.704135,22.1989893 C65.7000188,22.2031791 65.6958657,22.2073326 65.6916762,22.2114492 L44.677098,42.8607841 C44.4825957,43.0519059 44.1708242,43.0519358 43.9762853,42.8608513 L40.1545186,39.1069479 C39.9575152,38.9134427 39.9546793,38.5968729 40.1481845,38.3998695 C40.1502893,38.3977268 40.1524132,38.395603 40.1545562,38.3934985 L56.9937789,21.8567812 C57.1908028,21.6632968 57.193672,21.3467273 57.0001876,21.1497035 C56.9980647,21.1475418 56.9959223,21.1453995 56.9937605,21.1432767 L40.1545208,4.60825197 C39.9574869,4.41477773 39.9546013,4.09820839 40.1480756,3.90117456 C40.1501626,3.89904911 40.1522686,3.89694235 40.1543933,3.89485454 Z" fill="#FFFFFF" />
                <path class="two" d="M20.1543933,3.89485454 L23.9763149,0.139296592 C24.1708311,-0.0518420739 24.4826329,-0.0518571125 24.6771675,0.139262789 L45.6916134,20.7848311 C46.0855801,21.1718824 46.0911863,21.8050225 45.704135,22.1989893 C45.7000188,22.2031791 45.6958657,22.2073326 45.6916762,22.2114492 L24.677098,42.8607841 C24.4825957,43.0519059 24.1708242,43.0519358 23.9762853,42.8608513 L20.1545186,39.1069479 C19.9575152,38.9134427 19.9546793,38.5968729 20.1481845,38.3998695 C20.1502893,38.3977268 20.1524132,38.395603 20.1545562,38.3934985 L36.9937789,21.8567812 C37.1908028,21.6632968 37.193672,21.3467273 37.0001876,21.1497035 C36.9980647,21.1475418 36.9959223,21.1453995 36.9937605,21.1432767 L20.1545208,4.60825197 C19.9574869,4.41477773 19.9546013,4.09820839 20.1480756,3.90117456 C20.1501626,3.89904911 20.1522686,3.89694235 20.1543933,3.89485454 Z" fill="#FFFFFF" />
                <path class="three" d="M0.154393339,3.89485454 L3.97631488,0.139296592 C4.17083111,-0.0518420739 4.48263286,-0.0518571125 4.67716753,0.139262789 L25.6916134,20.7848311 C26.0855801,21.1718824 26.0911863,21.8050225 25.704135,22.1989893 C25.7000188,22.2031791 25.6958657,22.2073326 25.6916762,22.2114492 L4.67709797,42.8607841 C4.48259567,43.0519059 4.17082418,43.0519358 3.97628526,42.8608513 L0.154518591,39.1069479 C-0.0424848215,38.9134427 -0.0453206733,38.5968729 0.148184538,38.3998695 C0.150289256,38.3977268 0.152413239,38.395603 0.154556228,38.3934985 L16.9937789,21.8567812 C17.1908028,21.6632968 17.193672,21.3467273 17.0001876,21.1497035 C16.9980647,21.1475418 16.9959223,21.1453995 16.9937605,21.1432767 L0.15452076,4.60825197 C-0.0425130651,4.41477773 -0.0453986756,4.09820839 0.148075568,3.90117456 C0.150162624,3.89904911 0.152268631,3.89694235 0.154393339,3.89485454 Z" fill="#FFFFFF" />
              </g>
            </svg>
          </span>
          <span class="span">SUIVANT</span>
        </button>
      </div>
      <button id="generate-subject-btn" class="btn-impro">Générer un sujet  <i class="fas fa-random"></i></button>
      <div id="subject-wrapper">
        <span id="subject-display"></span>
      </div>
      <div id="advice-toggle">
        Des conseils avant de démarrer ta prise de parole ? <i id="advice-icon" class="fas fa-chevron-down"></i>
      </div>
      <div id="advice-text">
        1) Positionne tes yeux à hauteur de la caméra. <br><br>
        2) Choisis un fond neutre pour éviter toute distraction.<br><br>
        3) Assure-toi que l'éclairage te met en valeur. <br><br>
        4) Vérifie que le son et la vidéo fonctionnent.<br><br>
        5) Reste concentré et prends du plaisir. 
      </div>
      <div id="subject-error" class="error-message"></div>
      <!-- Fin du bouton Suivant (déjà présent ci-dessus) -->
    </div>

    <!-- STEP3 : Enregistrement vidéo -->
    <div class="box" id="step3">
      <div class="box-header">
        <button class="cta back-btn" id="back-btn3" aria-label="Retour à l'étape précédente">
          <span class="second">
            <svg width="50px" height="20px" viewBox="0 0 66 43" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlnsXlink="http://www.w3.org/1999/xlink">
              <g id="arrow" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                <path class="one" d="M40.1543933,3.89485454 L43.9763149,0.139296592 C44.1708311,-0.0518420739 44.4826329,-0.0518571125 44.6771675,0.139262789 L65.6916134,20.7848311 C66.0855801,21.1718824 66.0911863,21.8050225 65.704135,22.1989893 C65.7000188,22.2031791 65.6958657,22.2073326 65.6916762,22.2114492 L44.677098,42.8607841 C44.4825957,43.0519059 44.1708242,43.0519358 43.9762853,42.8608513 L40.1545186,39.1069479 C39.9575152,38.9134427 39.9546793,38.5968729 40.1481845,38.3998695 C40.1502893,38.3977268 40.1524132,38.395603 40.1545562,38.3934985 L56.9937789,21.8567812 C57.1908028,21.6632968 57.193672,21.3467273 57.0001876,21.1497035 C56.9980647,21.1475418 56.9959223,21.1453995 56.9937605,21.1432767 L40.1545208,4.60825197 C39.9574869,4.41477773 39.9546013,4.09820839 40.1480756,3.90117456 C40.1501626,3.89904911 40.1522686,3.89694235 40.1543933,3.89485454 Z" fill="#FFFFFF" />
                <path class="two" d="M20.1543933,3.89485454 L23.9763149,0.139296592 C24.1708311,-0.0518420739 24.4826329,-0.0518571125 24.6771675,0.139262789 L45.6916134,20.7848311 C46.0855801,21.1718824 46.0911863,21.8050225 45.704135,22.1989893 C45.7000188,22.2031791 45.6958657,22.2073326 45.6916762,22.2114492 L24.677098,42.8607841 C24.4825957,43.0519059 24.1708242,43.0519358 23.9762853,42.8608513 L20.1545186,39.1069479 C19.9575152,38.9134427 19.9546793,38.5968729 20.1481845,38.3998695 C20.1502893,38.3977268 20.1524132,38.395603 20.1545562,38.3934985 L36.9937789,21.8567812 C37.1908028,21.6632968 37.193672,21.3467273 37.0001876,21.1497035 C36.9980647,21.1475418 36.9959223,21.1453995 36.9937605,21.1432767 L20.1545208,4.60825197 C19.9574869,4.41477773 19.9546013,4.09820839 20.1480756,3.90117456 C20.1501626,3.89904911 20.1522686,3.89694235 20.1543933,3.89485454 Z" fill="#FFFFFF" />
                <path class="three" d="M0.154393339,3.89485454 L3.97631488,0.139296592 C4.17083111,-0.0518420739 4.48263286,-0.0518571125 4.67716753,0.139262789 L25.6916134,20.7848311 C26.0855801,21.1718824 26.0911863,21.8050225 25.704135,22.1989893 C25.7000188,22.2031791 25.6958657,22.2073326 25.6916762,22.2114492 L4.67709797,42.8607841 C4.48259567,43.0519059 4.17082418,43.0519358 3.97628526,42.8608513 L0.154518591,39.1069479 C-0.0424848215,38.9134427 -0.0453206733,38.5968729 0.148184538,38.3998695 C0.150289256,38.3977268 0.152413239,38.395603 0.154556228,38.3934985 L16.9937789,21.8567812 C17.1908028,21.6632968 17.193672,21.3467273 17.0001876,21.1497035 C16.9980647,21.1475418 16.9959223,21.1453995 16.9937605,21.1432767 L0.15452076,4.60825197 C-0.0425130651,4.41477773 -0.0453986756,4.09820839 0.148075568,3.90117456 C0.150162624,3.89904911 0.152268631,3.89694235 0.154393339,3.89485454 Z" fill="#FFFFFF" />
              </g>
            </svg>
          </span>
          <span class="span">RETOUR</span>
        </button>
        <div class="box-title">Lance ton improvisation</div>
      </div>
      <div id="current-subject-display" class="subject-bubble"></div>
      <div class="video-box">
        <video id="preview" autoplay muted playsinline webkit-playsinline></video>
        <div class="video-overlay">
          <p>Ici va s'enregistrer ton improvisation vidéo. Lorsque tu es prêt, clique sur le bouton ci-dessous.</p>
          <button id="start-btn" aria-label="Démarrer l'improvisation">
            Démarrer ton impro <i class="fas fa-video"></i>
          </button>
          <p>NB : ta vidéo est stockée sur ton appareil. Aucun enregistrement n'est conservé par Letmotiv.</p>
        </div>
        <div class="recording-indicator" id="recording-indicator">
          <span class="dot"></span> Enregistrement en cours
        </div>
        <div class="countdown" id="countdown">1:59</div>
        <div class="initial-countdown-overlay" id="initial-countdown-overlay">
          <div class="initial-countdown" id="initial-countdown">3</div>
        </div>
      </div>
      <div class="impro-actions">
        <button id="stop-btn" class="hidden-btn btn-impro" aria-label="Arrêter l'improvisation">
          Arrêter ton impro <i class="fas fa-stop"></i>
        </button>
        <button id="restart-btn" class="hidden-btn btn-impro" aria-label="Recommencer l'improvisation">
          Recommencer ton impro <i class="fas fa-redo"></i>
        </button>
      </div>
      <div id="impro-error" class="error-message"></div>
      <!-- Bouton Suivant -->
      <button class="cta next-btn" id="next-btn3" aria-label="Étape suivante">
        <span class="span">SUIVANT</span>
        <span class="second">
          <svg width="50px" height="20px" viewBox="0 0 66 43" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlnsXlink="http://www.w3.org/1999/xlink">
            <g id="arrow" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
              <path class="one" d="M40.1543933,3.89485454 L43.9763149,0.139296592 C44.1708311,-0.0518420739 44.4826329,-0.0518571125 44.6771675,0.139262789 L65.6916134,20.7848311 C66.0855801,21.1718824 66.0911863,21.8050225 65.704135,22.1989893 C65.7000188,22.2031791 65.6958657,22.2073326 65.6916762,22.2114492 L44.677098,42.8607841 C44.4825957,43.0519059 44.1708242,43.0519358 43.9762853,42.8608513 L40.1545186,39.1069479 C39.9575152,38.9134427 39.9546793,38.5968729 40.1481845,38.3998695 C40.1502893,38.3977268 40.1524132,38.395603 40.1545562,38.3934985 L56.9937789,21.8567812 C57.1908028,21.6632968 57.193672,21.3467273 57.0001876,21.1497035 C56.9980647,21.1475418 56.9959223,21.1453995 56.9937605,21.1432767 L40.1545208,4.60825197 C39.9574869,4.41477773 39.9546013,4.09820839 40.1480756,3.90117456 C40.1501626,3.89904911 40.1522686,3.89694235 40.1543933,3.89485454 Z" fill="#FFFFFF" />
              <path class="two" d="M20.1543933,3.89485454 L23.9763149,0.139296592 C24.1708311,-0.0518420739 24.4826329,-0.0518571125 24.6771675,0.139262789 L45.6916134,20.7848311 C46.0855801,21.1718824 46.0911863,21.8050225 45.704135,22.1989893 C45.7000188,22.2031791 45.6958657,22.2073326 45.6916762,22.2114492 L24.677098,42.8607841 C24.4825957,43.0519059 24.1708242,43.0519358 23.9762853,42.8608513 L20.1545186,39.1069479 C19.9575152,38.9134427 19.9546793,38.5968729 20.1481845,38.3998695 C20.1502893,38.3977268 20.1524132,38.395603 20.1545562,38.3934985 L36.9937789,21.8567812 C37.1908028,21.6632968 37.193672,21.3467273 37.0001876,21.1497035 C36.9980647,21.1475418 36.9959223,21.1453995 36.9937605,21.1432767 L20.1545208,4.60825197 C19.9574869,4.41477773 19.9546013,4.09820839 20.1480756,3.90117456 C20.1501626,3.89904911 20.1522686,3.89694235 20.1543933,3.89485454 Z" fill="#FFFFFF" />
              <path class="three" d="M0.154393339,3.89485454 L3.97631488,0.139296592 C4.17083111,-0.0518420739 4.48263286,-0.0518571125 4.67716753,0.139262789 L25.6916134,20.7848311 C26.0855801,21.1718824 26.0911863,21.8050225 25.704135,22.1989893 C25.7000188,22.2031791 25.6958657,22.2073326 25.6916762,22.2114492 L4.67709797,42.8607841 C4.48259567,43.0519059 4.17082418,43.0519358 3.97628526,42.8608513 L0.154518591,39.1069479 C-0.0424848215,38.9134427 -0.0453206733,38.5968729 0.148184538,38.3998695 C0.150289256,38.3977268 0.152413239,38.395603 0.154556228,38.3934985 L16.9937789,21.8567812 C17.1908028,21.6632968 17.193672,21.3467273 17.0001876,21.1497035 C16.9980647,21.1475418 16.9959223,21.1453995 16.9937605,21.1432767 L0.15452076,4.60825197 C-0.0425130651,4.41477773 -0.0453986756,4.09820839 0.148075568,3.90117456 C0.150162624,3.89904911 0.152268631,3.89694235 0.154393339,3.89485454 Z" fill="#FFFFFF" />
            </g>
          </svg>
        </span>
      </button>
    </div>

    <!-- STEP4 : Analyse ta prestation & Téléchargements -->
    <div class="box" id="step5">
      <div class="box-header">
        <button class="cta back-btn" id="back-btn5" aria-label="Retour à l'étape précédente">
          <span class="second">
            <svg width="50px" height="20px" viewBox="0 0 66 43" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlnsXlink="http://www.w3.org/1999/xlink">
              <g id="arrow" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                <path class="one" d="M40.1543933,3.89485454 L43.9763149,0.139296592 C44.1708311,-0.0518420739 44.4826329,-0.0518571125 44.6771675,0.139262789 L65.6916134,20.7848311 C66.0855801,21.1718824 66.0911863,21.8050225 65.704135,22.1989893 C65.7000188,22.2031791 65.6958657,22.2073326 65.6916762,22.2114492 L44.677098,42.8607841 C44.4825957,43.0519059 44.1708242,43.0519358 43.9762853,42.8608513 L40.1545186,39.1069479 C39.9575152,38.9134427 39.9546793,38.5968729 40.1481845,38.3998695 C40.1502893,38.3977268 40.1524132,38.395603 40.1545562,38.3934985 L56.9937789,21.8567812 C57.1908028,21.6632968 57.193672,21.3467273 57.0001876,21.1497035 C56.9980647,21.1475418 56.9959223,21.1453995 56.9937605,21.1432767 L40.1545208,4.60825197 C39.9574869,4.41477773 39.9546013,4.09820839 40.1480756,3.90117456 C40.1501626,3.89904911 40.1522686,3.89694235 40.1543933,3.89485454 Z" fill="#FFFFFF" />
                <path class="two" d="M20.1543933,3.89485454 L23.9763149,0.139296592 C24.1708311,-0.0518420739 24.4826329,-0.0518571125 24.6771675,0.139262789 L45.6916134,20.7848311 C46.0855801,21.1718824 46.0911863,21.8050225 45.704135,22.1989893 C45.7000188,22.2031791 45.6958657,22.2073326 45.6916762,22.2114492 L24.677098,42.8607841 C24.4825957,43.0519059 24.1708242,43.0519358 23.9762853,42.8608513 L20.1545186,39.1069479 C19.9575152,38.9134427 19.9546793,38.5968729 20.1481845,38.3998695 C20.1502893,38.3977268 20.1524132,38.395603 20.1545562,38.3934985 L36.9937789,21.8567812 C37.1908028,21.6632968 37.193672,21.3467273 37.0001876,21.1497035 C36.9980647,21.1475418 36.9959223,21.1453995 36.9937605,21.1432767 L20.1545208,4.60825197 C19.9574869,4.41477773 19.9546013,4.09820839 20.1480756,3.90117456 C20.1501626,3.89904911 20.1522686,3.89694235 20.1543933,3.89485454 Z" fill="#FFFFFF" />
                <path class="three" d="M0.154393339,3.89485454 L3.97631488,0.139296592 C4.17083111,-0.0518420739 4.48263286,-0.0518571125 4.67716753,0.139262789 L25.6916134,20.7848311 C26.0855801,21.1718824 26.0911863,21.8050225 25.704135,22.1989893 C25.7000188,22.2031791 25.6958657,22.2073326 25.6916762,22.2114492 L4.67709797,42.8607841 C4.48259567,43.0519059 4.17082418,43.0519358 3.97628526,42.8608513 L0.154518591,39.1069479 C-0.0424848215,38.9134427 -0.0453206733,38.5968729 0.148184538,38.3998695 C0.150289256,38.3977268 0.152413239,38.395603 0.154556228,38.3934985 L16.9937789,21.8567812 C17.1908028,21.6632968 17.193672,21.3467273 17.0001876,21.1497035 C16.9980647,21.1475418 16.9959223,21.1453995 16.9937605,21.1432767 L0.15452076,4.60825197 C-0.0425130651,4.41477773 -0.0453986756,4.09820839 0.148075568,3.90117456 C0.150162624,3.89904911 0.152268631,3.89694235 0.154393339,3.89485454 Z" fill="#FFFFFF" />
              </g>
            </svg>
          </span>
          <span class="span">RETOUR</span>
        </button>
        <div class="box-title">Analyse ta prestation</div>
      </div>
      <div class="download-section">
        <div class="download-section-accent">
          <h2>Obtiens gratuitement ta prestation en vidéo et la grille d'analyse Letmotiv</h2>
          <p class="subtitle">Analyse et évalue ton improvisation grâce aux conseils Letmotiv.</p>
          <p class="reassure">
            N'hésite pas à t'entraîner et refaire des improvisations pour progresser sur tes axes d'amélioration.
          </p>
        </div>
        <div class="download-fields">
          <div class="input-group">
            <label for="prenom">Prénom :</label>
            <input type="text" id="prenom" placeholder="Votre prénom" aria-label="Prénom"/>
            <div id="prenom-error" class="error-message"></div>
          </div>
          <div class="input-group">
            <label for="email">Email :</label>
            <input type="email" id="email" placeholder="Votre email" aria-label="Email"/>
            <div id="email-error" class="error-message"></div>
          </div>
        </div>
        <div class="call-to-action">
          <button id="validate-form-btn" aria-label="Valider les informations">
            Valider
          </button>
        </div>
        <div id="success-message" class="success-message" style="display: none;">
          Merci ! Tes informations ont été enregistrées et tes ressources sont prêtes à être téléchargées.
        </div>
        <div class="download-buttons" id="download-buttons">
          <button id="download-video-btn" aria-label="Télécharger ta vidéo">
            <i class="fas fa-download"></i> Télécharger ta vidéo
          </button>
          <button id="download-pdf-btn" aria-label="Télécharger la grille d'évaluation">
            <i class="fas fa-download"></i> Télécharger la grille d'évaluation
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Bouton de partage LinkedIn -->
  <button class="linkedin-share-btn" id="linkedin-share-btn" aria-label="Partager sur LinkedIn">
    <i class="fab fa-linkedin-in"></i>
  </button>

  <!-- SCRIPT JavaScript -->
  <script>
    /***********************
     * VARIABLES ET CONSTANTES
     ***********************/
    const boxes = {
      1: document.getElementById('step1'),
      2: document.getElementById('step2'),
      3: document.getElementById('step3'),
      4: document.getElementById('step5')
    };

    const nextBtns = {
      1: document.getElementById('next-btn1'),
      2: document.getElementById('next-btn2'),
      3: document.getElementById('next-btn3')
    };

    const backBtns = {
      2: document.getElementById('back-btn2'),
      3: document.getElementById('back-btn3'),
      4: document.getElementById('back-btn5')
    };

    const introBox = document.getElementById('intro-box');
    const startIntroBtn = document.getElementById('start-intro-btn');
    const topProgressBar = document.getElementById('top-progress-bar');
    const linkedinShareBtn = document.getElementById('linkedin-share-btn');

    let currentStep = 0;
    let currentCategory = null;
    let currentObjective = "";
    let currentSubject = "";

    let isImproRecordingStarted = false;
    let mediaRecorderInstance;
    let recordedChunks = [];
    let videoURL = "";
    let timerInterval;
    let timeRemaining = 120;
    let countdown;

    /***********************
     * FONCTIONS UTILITAIRES
     ***********************/
    function updateProgressBar(step) {
      const progress = (step / 4) * 100;
      topProgressBar.style.width = `${progress}%`;
    }

    function displayError(elementId, message) {
      const el = document.getElementById(elementId);
      el.textContent = message;
      el.style.display = 'block';
    }

    function updateShareButtonVisibility() {
      linkedinShareBtn.style.display = currentStep === 0 ? 'none' : 'flex';
    }

    /***********************
     * GESTION DE LA NAVIGATION ENTRE LES ÉTAPES
     ***********************/
    function showBox(current, next) {
      if (!boxes[current] || !boxes[next]) return;
      boxes[current].classList.remove('active', 'slide-from-bottom', 'slide-from-top');
      boxes[next].classList.add('active');
      boxes[next].classList.add(next > current ? 'slide-from-bottom' : 'slide-from-top');
      updateProgressBar(next);
      currentStep = next;
      updateShareButtonVisibility();
      if (next === 2) {
        document.getElementById('current-objective').textContent = currentObjective;
      }
      if (next === 3) {
        document.getElementById('current-subject-display').textContent = currentSubject;
      }
      removePulseFromAll();
    }

    function initNavigationButtons() {
      nextBtns[1].addEventListener('click', () => {
        const selected = document.querySelector('.objectives-container .selected-objective');
        if (!selected) {
          displayError('objective-error', "Sélectionne un objectif avant de continuer.");
          return;
        }
        showBox(1, 2);
      });
      nextBtns[2].addEventListener('click', () => {
        if (!currentSubject) {
          displayError('subject-error', "Tu dois générer un sujet avant de continuer.");
          return;
        }
        showBox(2, 3);
      });
      nextBtns[3].addEventListener('click', () => {
        const improErrorDiv = document.getElementById('impro-error');
        improErrorDiv.style.display = 'none';
        if (!currentSubject || !isImproRecordingStarted) {
          displayError('impro-error', "Tu dois lancer ton improvisation avant de continuer.");
          return;
        }
        showBox(3, 4);
      });
      backBtns[2].addEventListener('click', () => { showBox(2, 1); });
      backBtns[3].addEventListener('click', () => { showBox(3, 2); });
      backBtns[4].addEventListener('click', () => { showBox(4, 3); });
    }

    function removePulseFromAll() {
      Object.values(nextBtns).forEach(btn => btn.classList.remove('pulse'));
    }

    /***********************
     * INITIALISATION DE L'INTRODUCTION
     ***********************/
    startIntroBtn.addEventListener('click', () => {
      introBox.style.animation = 'fadeOut 0.5s ease forwards';
      setTimeout(() => {
        introBox.style.display = 'none';
        boxes[1].classList.add('active', 'slide-from-bottom');
        currentStep = 1;
        updateProgressBar(1);
        removePulseFromAll();
        updateShareButtonVisibility();
      }, 500);
    });

    /***********************
     * GESTION DES OBJECTIFS (STEP1)
     ***********************/
    const explanations = {
      convaincre:   "Tu as 2 minutes pour convaincre ton auditoire sur un sujet délicat",
      inspirer:     "Tu as 2 minutes pour inspirer ton auditoire",
      toast:        "Tu as 2 minutes pour porter un toast marquant lors d'un événement",
      repartie:     "Savoir répondre avec justesse et rapidité à une remarque désagréable au travail",
      vendre:       "Tu as 2 minutes pour vendre un objet insolite",
      conflit:      "Gère un désaccord ou une tension avec diplomatie",
      diction:      "Répète une phrase complexe plusieurs fois de suite sans te tromper",
      entretien:    "Convaincs ton futur employeur que tu es la pépite qu'il recherche",
      'lacher-prise': "Oublie la censure et exprime ton grain de folie"
    };

    const txtFilesByCategory = {
      convaincre:   "https://raw.githubusercontent.com/Citizen11bf/letmotiv/data/convaincre.txt",
      inspirer:     "https://raw.githubusercontent.com/Citizen11bf/letmotiv/data/inspirer.txt",
      'lacher-prise': "https://raw.githubusercontent.com/Citizen11bf/letmotiv/data/lacher_prise.txt",
      toast:        "https://raw.githubusercontent.com/Citizen11bf/letmotiv/data/toast.txt",
      repartie:     "https://raw.githubusercontent.com/Citizen11bf/letmotiv/data/repartie.txt",
      vendre:       "https://raw.githubusercontent.com/Citizen11bf/letmotiv/data/vendre.txt",
      conflit:      "https://raw.githubusercontent.com/Citizen11bf/letmotiv/data/gerer_un_conflit.txt",
      diction:      "https://raw.githubusercontent.com/Citizen11bf/letmotiv/data/diction.txt",
      entretien:    "https://raw.githubusercontent.com/Citizen11bf/letmotiv/data/entretien.txt"
    };

    let subjectsCache = {
      convaincre: null,
      inspirer: null,
      'lacher-prise': null,
      toast: null,
      repartie: null,
      vendre: null,
      conflit: null,
      diction: null,
      entretien: null
    };

    const objectivesButtons = document.querySelectorAll('.objectives-container .objective-item');
    const explanationBox = document.getElementById('explanation-box');

    objectivesButtons.forEach(item => {
      item.addEventListener('click', async () => {
        objectivesButtons.forEach(el => {
          el.classList.remove('selected-objective');
          el.style.transform = "";
          el.style.backgroundColor = "";
        });
        item.classList.add('selected-objective');
        currentCategory = item.dataset.category;
        currentObjective = item.innerText;
        item.style.transition = "transform 0.3s, background-color 0.3s";
        item.style.transform = "scale(1.1)";
        item.style.backgroundColor = "rgba(0, 164, 138, 0.2)";
        setTimeout(() => { item.style.transform = ""; }, 300);

        if(window.innerWidth <= 600) {
          const existingExp = document.querySelector('.mobile-explanation');
          if(existingExp) { existingExp.remove(); }
          const exp = explanations[currentCategory] || "";
          if(exp) {
            item.insertAdjacentHTML('afterend', `<div class="mobile-explanation">${exp}</div>`);
          }
        } else {
          const exp = explanations[currentCategory] || "";
          explanationBox.textContent = exp;
          explanationBox.classList.add('show');
        }
        if (subjectsCache[currentCategory] === null) {
          await loadSubjects(currentCategory);
        }
        document.getElementById('objective-error').style.display = 'none';
        document.getElementById('impro-error').style.display = 'none';
        removePulseFromAll();
        nextBtns[1].classList.add('pulse');
      });
    });

    async function loadSubjects(category) {
      const filePath = txtFilesByCategory[category];
      if (!filePath) return [];
      try {
        const response = await fetch(filePath);
        if (!response.ok) {
          console.error("Erreur fetch:", filePath);
          return [];
        }
        const text = await response.text();
        const lines = text.split('\n').map(l => l.trim()).filter(l => l.length > 0);
        subjectsCache[category] = lines;
        return lines;
      } catch (err) {
        console.error("Erreur fetch: ", err);
        return [];
      }
    }

    /***********************
     * GESTION DU SUJET D'IMPRO (STEP2)
     ***********************/
    const generateSubjectBtn = document.getElementById('generate-subject-btn');
    const subjectWrapper = document.getElementById('subject-wrapper');
    const subjectDisplay = document.getElementById('subject-display');

    generateSubjectBtn.addEventListener('click', () => {
      if (!currentCategory) {
        displayError('objective-error', "Merci de sélectionner un objectif avant de générer un sujet.");
        return;
      }
      const subjects = subjectsCache[currentCategory];
      if (!subjects || subjects.length === 0) {
        subjectDisplay.textContent = "Désolé, aucun sujet n'est disponible pour le moment. Veuillez réessayer plus tard.";
        subjectWrapper.style.display = 'block';
        currentSubject = "";
        return;
      }
      const randomIndex = Math.floor(Math.random() * subjects.length);
      currentSubject = subjects[randomIndex];
      subjectDisplay.textContent = currentSubject;
      subjectWrapper.style.display = 'block';
      generateSubjectBtn.classList.add('subject-generated');
      document.getElementById('subject-error').style.display = 'none';
      removePulseFromAll();
      nextBtns[2].classList.add('pulse');
    });

    document.getElementById('advice-toggle').addEventListener('click', () => {
      const adviceText = document.getElementById('advice-text');
      const adviceIcon = document.getElementById('advice-icon');
      if (adviceText.style.display === 'none' || adviceText.style.display === '') {
        adviceText.style.display = 'block';
        adviceIcon.classList.remove('fa-chevron-down');
        adviceIcon.classList.add('fa-chevron-up');
        adviceIcon.style.transform = 'rotate(0deg)';
      } else {
        adviceText.style.display = 'none';
        adviceIcon.classList.remove('fa-chevron-up');
        adviceIcon.classList.add('fa-chevron-down');
        adviceIcon.style.transform = 'rotate(0deg)';
      }
    });

    /***********************
     * ENREGISTREMENT VIDÉO (STEP3)
     ***********************/
    function bindStartButton() {
      const startBtn = document.getElementById('start-btn');
      if(startBtn){
        startBtn.addEventListener('click', startImpro);
      }
    }

    async function startImpro() {
      if (!currentSubject) {
        displayError('impro-error', "Tu dois générer un sujet avant de démarrer l'improvisation.");
        return;
      }
      if (typeof MediaRecorder === 'undefined' || !navigator.mediaDevices?.getUserMedia) {
        displayError('impro-error', "Désolé, l'enregistrement vidéo n'est pas supporté par votre navigateur.");
        return;
      }
      if (!confirm("Votre webcam va se lancer pour démarrer l'improvisation. Voulez-vous continuer ?")) {
        return;
      }
      if (window.innerWidth <= 600) {
          const videoBox = document.querySelector('.video-box');
          videoBox.style.height = "450px";
      }
      document.querySelector('.video-overlay').style.display = 'none';
      startInitialCountdown();
    }

    function startInitialCountdown() {
      let count = 5;
      document.getElementById('initial-countdown').textContent = count;
      document.getElementById('initial-countdown-overlay').style.display = 'flex';
      countdown = setInterval(() => {
        count--;
        if (count > 0) {
          document.getElementById('initial-countdown').textContent = count;
        } else {
          clearInterval(countdown);
          document.getElementById('initial-countdown-overlay').style.display = 'none';
          initiateRecording();
        }
      }, 1000);
    }

    async function initiateRecording() {
      const stream = await setupCamera();
      if (!stream) return;
      if (!window.MediaRecorder || typeof MediaRecorder.isTypeSupported === 'undefined') {
        displayError('impro-error', "Ton navigateur ne supporte pas l'enregistrement vidéo. Essaye avec Chrome, Edge ou Firefox.");
        return;
      }
      mediaRecorderInstance = new MediaRecorder(stream);
      recordedChunks = [];
      mediaRecorderInstance.ondataavailable = (event) => {
        if (event.data.size > 0) {
          recordedChunks.push(event.data);
        }
      };
      mediaRecorderInstance.onstop = () => {
        const videoBlob = new Blob(recordedChunks, { type: 'video/mp4' });
        videoURL = URL.createObjectURL(videoBlob);
        stream.getTracks().forEach(t => t.stop());
        const overlay = document.querySelector('.video-overlay');
        overlay.innerHTML = "<p style='color: white; font-size: 18px; text-align: center;'>Improvisation terminée. Passe à l'étape suivante !</p>";
        overlay.style.display = 'flex';
        document.getElementById('impro-error').style.display = 'none';
        document.getElementById('recording-indicator').style.display = 'none';
        clearInterval(timerInterval);
        isImproRecordingStarted = true;
        removePulseFromAll();
        nextBtns[3].classList.add('pulse');
        enableNavigationButtons();
        if (window.innerWidth <= 600) {
            document.querySelector('.video-box').style.height = "300px";
        }
      };
      mediaRecorderInstance.start();
      document.getElementById('recording-indicator').style.display = 'flex';
      document.getElementById('stop-btn').classList.remove('hidden-btn');
      document.getElementById('stop-btn').disabled = false;
      document.getElementById('restart-btn').classList.add('hidden-btn');
      disableNavigationButtons();
      startTimer();
    }

    async function setupCamera() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
        document.getElementById('preview').srcObject = stream;
        return stream;
      } catch (error) {
        if (error.name === 'NotAllowedError') {
          displayError('impro-error', "Vous avez refusé l'accès à la webcam. Veuillez autoriser l'accès.");
        } else if (error.name === 'NotFoundError') {
          displayError('impro-error', "Aucune caméra/micro détectés.");
        } else {
          displayError('impro-error', "Erreur : Impossible d'accéder à la webcam.");
        }
        console.error(error);
        return null;
      }
    }

    function startTimer() {
      timeRemaining = 120;
      updateCountdownDisplay();
      timerInterval = setInterval(() => {
        timeRemaining--;
        if (timeRemaining >= 0) {
          updateCountdownDisplay();
        }
        if (timeRemaining < 0) {
          clearInterval(timerInterval);
          if (mediaRecorderInstance && mediaRecorderInstance.state === 'recording') {
            mediaRecorderInstance.stop();
            document.getElementById('restart-btn').classList.remove('hidden-btn');
          }
        }
      }, 1000);
    }
    function updateCountdownDisplay() {
      const minutes = Math.floor(timeRemaining / 60);
      const seconds = timeRemaining % 60;
      const countdownEl = document.getElementById('countdown');
      countdownEl.textContent = `${minutes}:${seconds < 10 ? '0' + seconds : seconds}`;
      countdownEl.style.display = 'block';
    }

    document.getElementById('stop-btn').addEventListener('click', () => {
      if (mediaRecorderInstance && mediaRecorderInstance.state === 'recording') {
        mediaRecorderInstance.stop();
        clearInterval(countdown);
        clearInterval(timerInterval);
        document.getElementById('stop-btn').classList.add('hidden-btn');
        document.getElementById('stop-btn').disabled = true;
        document.getElementById('restart-btn').classList.remove('hidden-btn');
        document.getElementById('recording-indicator').style.display = 'none';
      }
    });
    document.getElementById('restart-btn').addEventListener('click', () => {
      document.getElementById('restart-btn').classList.add('hidden-btn');
      document.querySelector('.video-overlay').innerHTML = `
        <p>Ici va s'enregistrer ton improvisation vidéo. Lorsque tu es prêt, clique sur le bouton ci-dessous.</p>
        <button id="start-btn" aria-label="Démarrer l'improvisation">
          Démarrer ton impro <i class="fas fa-video"></i>
        </button>
        <p>NB : ta vidéo est stockée sur ton appareil. Aucun enregistrement n'est conservé par Letmotiv.</p>
      `;
      document.querySelector('.video-overlay').style.display = 'flex';
      isImproRecordingStarted = false;
      bindStartButton();
    });
    bindStartButton();

    /***********************
     * TÉLÉCHARGEMENTS ET FORMULAIRE (STEP4)
     ***********************/
    const validateFormBtn = document.getElementById('validate-form-btn');
    const prenomInput = document.getElementById('prenom');
    const emailInput = document.getElementById('email');
    const prenomError = document.getElementById('prenom-error');
    const emailError = document.getElementById('email-error');
    const downloadButtons = document.getElementById('download-buttons');
    const downloadVideoBtn = document.getElementById('download-video-btn');
    const downloadPdfBtn = document.getElementById('download-pdf-btn');

    validateFormBtn.addEventListener('click', () => {
      const prenomValue = prenomInput.value.trim();
      const emailValue = emailInput.value.trim();
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      const prenomRegex = /^[A-Za-zÀ-ÿ '-]+$/;

      let valid = true;
      prenomError.style.display = 'none';
      emailError.style.display = 'none';

      if (!prenomValue || !prenomRegex.test(prenomValue)) {
        prenomError.textContent = "Entre un prénom valide (sans chiffres ni caractères spéciaux).";
        prenomError.style.display = 'block';
        valid = false;
      }
      if (!emailValue) {
        emailError.textContent = "Merci de renseigner ton email pour continuer.";
        emailError.style.display = 'block';
        valid = false;
      } else if (!emailRegex.test(emailValue)) {
        emailError.textContent = "Entre une adresse email valide.";
        emailError.style.display = 'block';
        valid = false;
      }
      if (!valid) return;

      document.getElementById('hidden-prenom').value = prenomValue;
      document.getElementById('hidden-email').value = emailValue;
      document.getElementById('hidden-google-form').submit();

      const successMessage = document.getElementById('success-message');
      successMessage.style.display = 'block';
      successMessage.classList.add('show');
      setTimeout(() => {
        successMessage.classList.remove('show');
        successMessage.style.display = 'none';
      }, 5000);

      if (videoURL) {
        const link = document.createElement('a');
        link.href = videoURL;
        link.download = 'Letmotiv_Improvisation.mp4';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      }

      const callToActionDiv = document.querySelector('.call-to-action');
      callToActionDiv.innerHTML = `
        <button id="feedback-btn" aria-label="Feedback de l'impro" style="background-color: #ffcb2d; color: #000; border-radius: 30px; padding: 12px 24px; font-weight: bold; font-size: 1rem; transition: transform 0.2s, box-shadow 0.2s; margin: 10px auto;">
          Feedback de l'impro
        </button>`;
      document.getElementById('feedback-btn').addEventListener('click', () => {
        window.location.href = "https://www.letmotiv.fr/simulateur-prise-de-parole-en-public/feedback-impro";
      });
    });

    /***********************
     * PARTAGE SUR LINKEDIN
     ***********************/
    document.getElementById("linkedin-share-btn").addEventListener("click", () => {
      const shareURL = encodeURIComponent(window.location.href);
      const shareText = encodeURIComponent("Je m'entraîne à la prise de parole en public avec le simulateur Letmotiv !");
      const linkedInURL = `https://www.linkedin.com/sharing/share-offsite/?url=${shareURL}&summary=${shareText}`;
      window.open(linkedInURL, '_blank');
    });

    initNavigationButtons();

    function disableNavigationButtons() {
      Object.values(nextBtns).forEach(btn => btn.disabled = true);
      Object.values(backBtns).forEach(btn => btn.disabled = true);
    }
    function enableNavigationButtons() {
      Object.values(nextBtns).forEach(btn => btn.disabled = false);
      Object.values(backBtns).forEach(btn => btn.disabled = false);
    }
  </script>
</body>
</html>
