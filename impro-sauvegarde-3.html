<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Simulateur d'improvisation Letmotiv</title>
  <link rel="icon" href="https://raw.githubusercontent.com/Citizen11bf/letmotiv/refs/heads/images/Letmotiv_favicon.webp" type="image/png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans&family=Montserrat:wght@700&display=swap" rel="stylesheet" />
  <style>
    html, body { margin:0; padding:0; height:100%; overflow-x:hidden; }
    body { font-family:'DM Sans', sans-serif; background:#fff; padding-top:60px; padding-bottom:70px; }
    /* HEADER */
    .header {
      position:fixed; top:0; left:0; width:100%; background:#182d84; color:#fff;
      text-align:center; padding:10px; z-index:100;
    }
    .header-l1 { font-size:16px; font-weight:bold; }
    .header-l2 { font-size:14px; }
    /* PROGRESS BAR avec rep√®res tous les 20% */
    .progress-container {
      position:fixed; top:60px; left:0; width:100%; height:10px;
      background: rgba(24,45,132,0.1);
      background-image:
        repeating-linear-gradient(
          to right,
          transparent,
          transparent calc(20% - 1px),
          #ccc calc(20% - 1px),
          #ccc 20%
        );
      z-index:90;
    }
    .progress-bar { height:100%; width:0; background:#00a48a; transition: width 0.5s ease; }
    /* FOOTER fixe */
    .footer-nav {
      position:fixed; bottom:0; left:0; width:100%; background:#fff;
      box-shadow:0 -2px 5px rgba(0,0,0,0.1); padding:10px; text-align:center; z-index:100;
    }
    .btn-next {
      background:#00a48a; color:#fff; border:none; padding:12px 30px;
      border-radius:8px; font-size:16px; cursor:pointer; transition:opacity .3s;
    }
    .btn-next:disabled {
      background:#ccc; color:#777; cursor:not-allowed; opacity:.6;
    }
    /* BOXES */
    .main-container { max-width:600px; margin:80px auto 0; }
    .box {
      display:none; background:#f9f9f9; border-radius:12px;
      box-shadow:0 4px 12px rgba(0,0,0,0.1); padding:20px; margin-bottom:20px;
      text-align:center;
    }
    .box.active { display:block; }
    h1, h2 { margin:0 0 15px; color:#182d84; }
    /* INTRO */
    .intro-box {
      position:fixed; top:0; left:0; width:100%; height:100%;
      background:linear-gradient(135deg,#182d84,#00a48a);
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      text-align:center; color:#fff; z-index:200;
      animation:fadeIn 1s ease forwards;
    }
    .intro-box h1 {
      font-family:'Montserrat',sans-serif; font-size:2.8rem; margin-bottom:50px;
      animation:slideDown 1s ease forwards; text-shadow:2px 2px 8px rgba(0,0,0,0.3);
    }
    .cta {
      display:flex; padding:10px 45px; text-decoration:none;
      font-family:'Poppins',sans-serif; font-size:40px;
      color:#fff; background:#FF5722; transform:skewX(-15deg);
      box-shadow:6px 6px 0 black; border-radius:8px; transition:.5s;
    }
    .cta span { transform:skewX(15deg); }
    .cta:hover { box-shadow:10px 10px 0 #FBC638; }
    @keyframes fadeIn { from{opacity:0} to{opacity:1} }
    @keyframes slideDown { from{transform:translateY(-50px);opacity:0} to{transform:translateY(0);opacity:1} }
    /* STEP1 : objectifs */
    .objectives-container {
      display:grid; grid-template-columns:repeat(auto-fit,minmax(100px,1fr)); gap:10px;
    }
    .objective-item {
      background:#f7f9fc; padding:12px; border-radius:8px;
      cursor:pointer; transition:transform .3s, background .3s, border-color .3s;
    }
    .objective-item.selected {
      background:rgba(0,164,138,0.2); transform:scale(1.1);
      border:1px solid #00a48a; color:#00a48a;
    }
    .objective-item i { font-size:1.8rem; margin-bottom:8px; display:block; color:#777; }
    /* STEP2 : g√©n√©ration sujet */
    #generate-subject-btn {
      background:#182d84; color:#fff; border:none; padding:10px 20px;
      border-radius:25px; cursor:pointer; transition:background .3s;
    }
    #generate-subject-btn:disabled { background:#ccc; cursor:not-allowed; }
    #subject-wrapper {
      display:none; margin-top:15px; padding:15px; border-radius:8px;
      background:linear-gradient(135deg,#00a48a,#182d84); color:#fff;
    }
    /* STEP3 : vid√©o */
    .subject-bubble {
      display:inline-block; padding:10px 15px; border:2px solid #ccc;
      border-radius:16px; background:#fefefe; margin-bottom:15px;
    }
    .video-box {
      position:relative; width:100%; max-width:500px; height:300px;
      margin:0 auto 15px; border:3px solid #182d84; border-radius:6px;
      background:#fefefe; overflow:hidden;
    }
    .video-box video {
      width:100%; height:100%; object-fit:cover; transform:scaleX(-1);
    }
    .video-overlay {
      position:absolute; top:0; left:0; width:100%; height:100%;
      background:rgba(255,255,255,0.7); display:flex;
      flex-direction:column; justify-content:center; align-items:center;
      text-align:center; padding:10px; z-index:2;
    }
    .video-overlay button {
      background:#182d84; color:#fff; border:none; padding:10px 20px;
      border-radius:25px; cursor:pointer; transition:background .3s;
    }
    .video-overlay button:hover { background:#00a48a; }
    .recording-indicator {
      position:absolute; top:10px; right:10px; display:flex;
      align-items:center; gap:5px; background:rgba(128,128,128,0.6);
      padding:5px 10px; border-radius:20px; color:#f00; z-index:3;
    }
    .recording-indicator .dot {
      width:10px; height:10px; background:#f00; border-radius:50%;
      animation:blink 1s infinite;
    }
    @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0} }
    .hidden-btn { display:none!important; }
  </style>
</head>
<body>

  <!-- INTRO -->
  <div class="intro-box" id="intro-box">
    <h1>
      <span class="line">ENTRAINE-TOI</span>
      <span class="line">A LA PRISE DE PAROLE</span>
      <span class="line">EN PUBLIC</span>
    </h1>
    <a id="start-intro-btn" class="cta" href="#">
      <span>COMMENCER</span>
    </a>
  </div>

  <!-- HEADER -->
  <div class="header">
    <div class="header-l1">Coaching en prise de parole</div>
    <div class="header-l2">Simulateur d'improvisation Letmotiv</div>
  </div>

  <!-- PROGRESS BAR -->
  <div class="progress-container">
    <div class="progress-bar" id="top-progress-bar"></div>
  </div>

  <div class="main-container">
    <!-- STEP1 -->
    <div class="box" id="step1">
      <h2>Quel est ton objectif¬†?</h2>
      <div class="objectives-container">
        <div class="objective-item" data-category="diction">
          <i class="fas fa-grin-tongue"></i>
          <span>Am√©liorer sa diction</span>
        </div>
        <div class="objective-item" data-category="repartie">
          <i class="fas fa-comments"></i>
          <span>Avoir de la r√©partie</span>
        </div>
        <div class="objective-item" data-category="convaincre">
          <i class="fas fa-handshake"></i>
          <span>Convaincre</span>
        </div>
        <div class="objective-item" data-category="conflit">
          <i class="fas fa-exclamation-triangle"></i>
          <span>G√©rer un conflit</span>
        </div>
        <div class="objective-item" data-category="inspirer">
          <i class="fas fa-lightbulb"></i>
          <span>Inspirer</span>
        </div>
        <div class="objective-item" data-category="lacher-prise">
          <i class="fas fa-smile"></i>
          <span>L√¢cher prise</span>
        </div>
        <div class="objective-item" data-category="toast">
          <i class="fas fa-glass-cheers"></i>
          <span>Porter un toast</span>
        </div>
        <div class="objective-item" data-category="entretien">
          <i class="fas fa-briefcase"></i>
          <span>R√©ussir son entretien</span>
        </div>
        <div class="objective-item" data-category="vendre">
          <i class="fas fa-money-bill-wave"></i>
          <span>Vendre</span>
        </div>
      </div>
    </div>

    <!-- STEP2 -->
    <div class="box" id="step2">
      <h2>Pr√™t √† relever le d√©fi¬†?</h2>
      <button id="generate-subject-btn">G√©n√©rer un sujet <i class="fas fa-random"></i></button>
      <div id="subject-wrapper">
        <span id="subject-display"></span>
      </div>
    </div>

        <!-- STEP3 -->
    <div class="box" id="step3">
      <h2>C'est parti, lance ton improvisation¬†!</h2>
      <div id="current-subject-display" class="subject-bubble"></div>
      <div class="video-box">
        <video id="preview" autoplay muted playsinline></video>
        <div class="video-overlay">
          <p>Ta vid√©o va s'enregistrer ici.</p>
          <button id="start-btn">D√©marrer ton impro <i class="fas fa-video"></i></button>
          <p>NB¬†: ta vid√©o est stock√©e sur ton appareil.</p>
        </div>
        <div class="recording-indicator" id="recording-indicator">
          <span class="dot"></span>
          <span id="countdown">2:00</span>
        </div>
        <button id="stop-btn" class="hidden-btn">Arr√™ter ton impro <i class="fas fa-stop"></i></button>
        <button id="restart-btn" class="hidden-btn">Recommencer ton impro <i class="fas fa-redo"></i></button>
      </div>
    </div>

    <!-- STEP4 -->
    <div class="box" id="step4">
      <h2>F√©licitations pour ton improvisation¬†! ü§©</h2>
      <div class="action-container">
        <button id="download-video-btn" class="btn-action">1) T√©l√©charger ta vid√©o</button>
        <div id="contact-btn" class="btn-action disabled">
          <span>2) Prendre rdv avec un expert¬†?</span>
          <div class="contact-options" style="margin-top:10px; display:flex; gap:8px; justify-content:center;">
            <button id="contact-yes">Oui ‚úì</button>
            <button id="contact-no">Non ‚úó</button>
          </div>
        </div>
        <button id="feedback-btn" class="btn-action disabled">3) Analyser ma prestation</button>
      </div>

      <!-- Newsletter -->
      <div class="newsletter-container" style="margin-top:30px; text-align:center;">
        <h3>Inscris-toi √† la newsletter Letmotiv pour progresser¬†:</h3>
        <form id="newsletter-form" style="display:flex; flex-direction:column; gap:10px; align-items:center; max-width:400px; margin:0 auto;">
          <input type="text" id="newsletter-prenom" placeholder="Pr√©nom" style="width:100%; padding:10px; border-radius:8px; border:none; background:#4a5568; color:#fff;" />
          <div id="newsletter-prenom-error" class="error-message" style="display:none;"></div>
          <input type="email" id="newsletter-email" placeholder="Email" style="width:100%; padding:10px; border-radius:8px; border:none; background:#4a5568; color:#fff;" />
          <div id="newsletter-email-error" class="error-message" style="display:none;"></div>
          <button type="submit" id="newsletter-submit-btn" class="btn-action" style="background:linear-gradient(135deg,#182d84,#00a48a);">S'abonner</button>
          <div id="newsletter-success" class="newsletter-success" style="display:none; color:green; margin-top:10px;">Tu es maintenant abonn√©¬†!</div>
        </form>
      </div>
    </div>

    <!-- STEP5 -->
    <div class="box" id="step5">
      <h2>Planifiez un appel avec nous</h2>
      <div class="calendly-inline-widget"
           data-url="https://calendly.com/letmotiv/premier-contact?hide_event_type_details=1"
           style="min-width:320px;height:800px;"></div>
    </div>

  </div> <!-- fin main-container -->

  <!-- FOOTER NAVIGATION -->
  <div class="footer-nav">
    <button id="footer-next-btn" class="btn-next" disabled>Suivant</button>
  </div>

  <!-- SCRIPT JS -->
  <script>
    // Intro -> premi√®re √©tape
    const introBox = document.getElementById('intro-box');
    const startIntroBtn = document.getElementById('start-intro-btn');
    startIntroBtn.addEventListener('click', () => {
      introBox.style.animation = 'fadeOut 0.5s ease forwards';
      setTimeout(() => {
        introBox.style.display = 'none';
        showStep(0);
      }, 500);
    });

    // Variables globales
    const boxes = document.querySelectorAll('.box');
    const footerNext = document.getElementById('footer-next-btn');
    const progressBar = document.getElementById('top-progress-bar');
    let currentStep = 0;
    let mediaRecorder, recordedChunks = [];

    // Affiche l'√©tape n et met √† jour la barre
    function showStep(n) {
      boxes.forEach((b,i)=>b.classList.toggle('active', i===n));
      currentStep = n;
      progressBar.style.width = (n/(boxes.length-1)*100) + '%';
      footerNext.disabled = true;
      setupStepValidation(n);
    }

    // Configure les validations et callbacks pour chaque √©tape
    function setupStepValidation(n) {
      footerNext.onclick = null;

      if (n === 0) {
        // STEP1 : s√©lection d'objectif
        document.querySelectorAll('.objective-item').forEach(el => {
          el.onclick = () => {
            document.querySelectorAll('.objective-item').forEach(x=>x.classList.remove('selected'));
            el.classList.add('selected');
            footerNext.disabled = false;
            // ici on pourrait stocker la cat√©gorie choisie
          };
        });
        footerNext.onclick = () => showStep(1);
      }

      if (n === 1) {
        // STEP2 : g√©n√©ration du sujet
        const genBtn = document.getElementById('generate-subject-btn');
        genBtn.disabled = false;
        genBtn.onclick = async () => {
          // Simule fetch + tirage
          const subjects = ['Sujet A','Sujet B','Sujet C'];
          const choix = subjects[Math.floor(Math.random()*subjects.length)];
          document.getElementById('subject-display').textContent = choix;
          document.getElementById('subject-wrapper').style.display = 'block';
          footerNext.disabled = false;
        };
        footerNext.onclick = () => showStep(2);
      }

      if (n === 2) {
        // STEP3 : enregistrement vid√©o
        const startBtn   = document.getElementById('start-btn');
        const stopBtn    = document.getElementById('stop-btn');
        const restartBtn = document.getElementById('restart-btn');
        let recorded = false;

        startBtn.onclick = async () => {
          // acc√®s cam√©ra + start mediaRecorder...
          const stream = await navigator.mediaDevices.getUserMedia({ video:true, audio:true });
          document.getElementById('preview').srcObject = stream;
          mediaRecorder = new MediaRecorder(stream);
          recordedChunks = [];
          mediaRecorder.ondataavailable = e => e.data.size && recordedChunks.push(e.data);
          mediaRecorder.onstop = () => {
            recorded = true;
            footerNext.disabled = false;
            restartBtn.classList.remove('hidden-btn');
          };
          mediaRecorder.start();
          document.querySelector('.video-overlay').style.display = 'none';
          stopBtn.classList.remove('hidden-btn');
        };

        stopBtn.onclick = () => {
          if (mediaRecorder && mediaRecorder.state === 'recording') {
            mediaRecorder.stop();
            document.getElementById('stop-btn').classList.add('hidden-btn');
          }
        };

        restartBtn.onclick = () => {
          if (!confirm("Attention, tu vas recommencer ton impro et lancer un nouvel enregistrement. Tu es s√ªr¬†?")) return;
          restartBtn.classList.add('hidden-btn');
          document.querySelector('.video-overlay').style.display = 'flex';
          footerNext.disabled = true;
        };

        footerNext.onclick = () => showStep(3);
      }

      if (n === 3) {
        // STEP4 : t√©l√©chargement & rdv & analyse & newsletter
        const dlBtn    = document.getElementById('download-video-btn');
        const contact  = document.getElementById('contact-btn');
        const fbBtn    = document.getElementById('feedback-btn');
        const yesBtn   = document.getElementById('contact-yes');
        const noBtn    = document.getElementById('contact-no');

        dlBtn.onclick = () => {
          footerNext.disabled = false;
          // cr√©ation du blob + download
          const blob = new Blob(recordedChunks, { type:'video/mp4' });
          const url  = URL.createObjectURL(blob);
          const a    = document.createElement('a');
          a.href     = url;
          a.download = 'impro.mp4';
          a.click();
          URL.revokeObjectURL(url);
          contact.classList.remove('disabled');
        };

        yesBtn.onclick = e => {
          e.preventDefault();
          showStep(4);
        };
        noBtn.onclick = e => {
          e.preventDefault();
          fbBtn.classList.remove('disabled');
          footerNext.disabled = false;
        };
        footerNext.onclick = () => showStep(4);

        // Newsletter
        const form       = document.getElementById('newsletter-form');
        const prError    = document.getElementById('newsletter-prenom-error');
        const emError    = document.getElementById('newsletter-email-error');
        const successEl  = document.getElementById('newsletter-success');
        form.addEventListener('submit', e => {
          e.preventDefault();
          prError.style.display = emError.style.display = 'none';
          let valid = true;
          if (!form['newsletter-prenom'].value.trim()) {
            prError.textContent = "Le pr√©nom est requis."; prError.style.display = 'block'; valid = false;
          }
          if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(form['newsletter-email'].value.trim())) {
            emError.textContent = "Email invalide."; emError.style.display = 'block'; valid = false;
          }
          if (!valid) return;
          // envoi fictif
          successEl.style.display = 'block';
          setTimeout(() => successEl.style.display = 'none', 5000);
        });
      }

      if (n === 4) {
        // STEP5 : Calendly
        footerNext.disabled = false;
        footerNext.onclick = () => alert("Merci¬†! √Ä bient√¥t.");
      }
    }

    // D√©marrer
    showStep(0);
  </script>

  <!-- Calendly widget script -->
  <script src="https://assets.calendly.com/assets/external/widget.js" async></script>
</body>
</html>
