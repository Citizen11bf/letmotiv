<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Simulateur d'improvisation</title>
  <meta name="description" content="Évaluer et entraîner sa prise de parole avec le simulateur d'improvisation Letmotiv.">
  <!-- Favicon & réseaux sociaux – inchangé -->
  <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/Citizen11bf/letmotiv/refs/heads/images/Letmotiv_favicon.webp"/>
  <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/Citizen11bf/letmotiv/refs/heads/images/Letmotiv_favicon.webp"/>
  <meta property="og:title" content="Simulateur d'improvisation Letmotiv"/>
  <meta property="og:description" content="Entraîne‑toi à la prise de parole en public."/>
  <meta property="og:type" content="website"/>
  <meta property="og:url" content="https://letmotiv-simulateur.fr"/>
  <meta property="og:image" content="https://i.postimg.cc/LXxJLTVx/Letmotiv-og-image.png"/>
  <meta name="twitter:card" content="summary_large_image"/>
  <meta name="twitter:title" content="Simulateur d'improvisation Letmotiv"/>
  <meta name="twitter:image" content="https://i.postimg.cc/LXxJLTVx/Letmotiv-og-image.png"/>

  <!-- Polices & icônes -->
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans&family=Montserrat:wght@700&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css?family=Poppins:900i" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"/>
  <link href="https://assets.calendly.com/assets/external/widget.css" rel="stylesheet"/>

  <!-- Styles principaux (identiques à la version précédente) -->
  <style>
    *{box-sizing:border-box}
    body{margin:0;font-family:'DM Sans',sans-serif;color:#333;background:#fff;padding:60px 0 80px}
    /* header, barre de progression, footer nav */
    .header{position:fixed;top:0;left:0;width:100%;background:#182d84;color:#fff;text-align:center;padding:10px 5px;font-weight:700;z-index:10}
    .header .header-l2{font-weight:400;font-size:14px}
    .progress-container{position:fixed;top:60px;left:0;width:100%;height:10px;background:rgba(24,45,132,.1);z-index:9}
    .progress-bar{width:0;height:100%;background:#00a48a;transition:width .4s}
    .footer-nav{position:fixed;bottom:0;left:0;width:100%;background:#182d84;display:none;justify-content:space-between;align-items:center;gap:10px;padding:10px;z-index:15}
    .footer-nav button{flex:1;padding:12px 0;font-size:16px;font-weight:700;border:none;border-radius:8px;color:#fff;background:#00a48a;cursor:pointer;transition:.3s}
    .footer-nav button:disabled{background:#ccc;cursor:default;opacity:.55}
    .pulse{animation:pulse 1.5s infinite}
    @keyframes pulse{0%{box-shadow:0 0 0 0 rgba(0,164,138,.7)}70%{box-shadow:0 0 0 12px rgba(0,164,138,0)}100%{box-shadow:0 0 0 0 rgba(0,164,138,0)}}

    /* intro splash */
    .intro-box{position:fixed;inset:0;background:linear-gradient(135deg,#182d84,#00a48a);display:flex;flex-direction:column;align-items:center;justify-content:center;color:#fff;z-index:20;animation:fadeIn 1s forwards}
    @keyframes fadeIn{from{opacity:0}to{opacity:1}}
    .intro-box h1{font-family:'Montserrat',sans-serif;text-align:center;font-size:2.8rem;margin:0 0 40px;text-shadow:2px 2px 6px rgba(0,0,0,.3)}
    .intro-box .cta{display:flex;align-items:center;gap:15px;font-family:'Poppins',sans-serif;font-size:36px;color:#fff;text-decoration:none;background:#ff5722;padding:10px 40px;border-radius:8px;box-shadow:6px 6px 0 #000;transform:skewX(-15deg);transition:.3s}
    .intro-box .cta span{transform:skewX(15deg)}
    .intro-box .cta:hover{box-shadow:10px 10px 0 #fbc638}
    @media(max-width:600px){.intro-box h1{font-size:2rem}.intro-box .cta{font-size:28px}}

    /* conteneur principal & boxes */
    .main-container{padding:20px}
    .box{max-width:600px;margin:0 auto 20px;padding:20px;border-radius:15px;background:linear-gradient(135deg,#fff,#f7f7f7);box-shadow:0 4px 12px rgba(0,0,0,.1);display:none;opacity:0;transition:opacity .4s}
    .box.active{display:block;opacity:1}
    .slide-from-bottom{animation:fromBottom .6s}
    @keyframes fromBottom{from{transform:translateY(30px);opacity:0}to{transform:translateY(0);opacity:1}}
    .box-title{font-weight:700;font-size:18px;color:#182d84;margin-bottom:15px}

    /* objectives grid */
    .objectives-container{display:grid;grid-template-columns:repeat(auto-fit,minmax(100px,1fr));gap:12px}
    .objective-item{padding:12px;border-radius:10px;text-align:center;cursor:pointer;transition:.25s}
    .objective-item:hover{background:rgba(0,164,138,.1)}
    .objective-item.selected-objective{background:rgba(0,164,138,.2);transform:scale(1.05);color:#00a48a;border:1px solid #00a48a}
    .objective-item i{font-size:1.6rem;margin-bottom:6px}

    /* sujet */
    #subject-wrapper{margin-top:12px;padding:14px;border-radius:8px;background:linear-gradient(135deg,#00a48a,#182d84);color:#fff;display:none}

    /* vidéo styles (identiques) */
    .video-box{position:relative;margin:10px auto;border:3px solid #182d84;border-radius:6px;max-width:500px;height:300px;background:#fefefe;display:flex;justify-content:center;align-items:center;overflow:hidden}
    .video-box video{width:100%;height:100%;object-fit:cover;transform:scaleX(-1)}
    .video-overlay{position:absolute;inset:0;background:rgba(255,255,255,.6);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:15px;text-align:center}
    .video-overlay button{padding:10px 22px;border:none;border-radius:25px;background:#182d84;color:#fff;font-size:16px;cursor:pointer;transition:.3s}
    .video-overlay button:hover{background:#00a48a}
    .recording-indicator{position:absolute;top:10px;right:10px;display:none;align-items:center;gap:6px;background:rgba(128,128,128,.6);padding:4px 10px;border-radius:20px;font-size:14px;color:#ff0000}
    .recording-indicator .dot{width:10px;height:10px;border-radius:50%;background:#ff0000;animation:blink 1s infinite}
    @keyframes blink{0%,100%{opacity:1}50%{opacity:.2}}

    /* bouton partage */
    #global-share-btn{position:fixed;bottom:95px;right:20px;width:42px;height:42px;border-radius:50%;background:#182d84;color:#fff;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:20px;z-index:999}
  </style>
</head>
<body>
  <!-- INTRO -->
  <div class="intro-box" id="intro-box">
    <h1><span>ENTRAINE‑TOI</span><span>À LA PRISE DE PAROLE</span><span>EN PUBLIC</span></h1>
    <a id="start-intro-btn" class="cta" href="#"><span>COMMENCER</span></a>
  </div>

  <!-- HEADER & PROGRESS -->
  <div class="header"><div class="header-l1">Coaching en prise de parole</div><div class="header-l2">Simulateur d'improvisation Letmotiv</div></div>
  <div class="progress-container"><div class="progress-bar" id="progress-bar"></div></div>

  <!-- MAIN -->
  <div class="main-container">
    <!-- STEP 1 -->
    <section class="box" id="step1">
      <h2 class="box-title">Quel est ton objectif ?</h2>
      <div class="objectives-container" id="objectives"></div>
      <div id="objective-error" class="error-message"></div>
    </section>

    <!-- STEP 2 -->
    <section class="box" id="step2">
      <h2 class="box-title">Prêt à relever le défi ?</h2>
      <button id="generate-subject-btn" class="btn-impro">Générer un sujet <i class="fas fa-random"></i></button>
      <div id="subject-wrapper"><span id="subject-display"></span></div>
      <div id="subject-error" class="error-message"></div>
    </section>

    <!-- STEP 3 -->
    <section class="box" id="step3">
      <h2 class="box-title">C'est parti !</h2>
      <div id="current-subject-display" class="subject-bubble"></div>
      <div class="video-box">
        <video id="preview" autoplay muted playsinline></video>
        <div class="video-overlay" id="video-overlay">
          <p>Ta vidéo va s'enregistrer ici.</p>
          <button id="start-btn">Démarrer <i class="fas fa-video"></i></button>
          <p class="info">NB : la vidéo reste sur ton appareil.</p>
        </div>
        <div class="recording-indicator" id="recording-indicator"><span class="dot"></span><span id="countdown">2:00</span></div>
        <div class="initial-countdown-overlay" id="initial-countdown-overlay"><span id="initial-countdown" style="font-size:48px;color:#fff;font-weight:700">3</span></div>
      </div>
      <div id="impro-error" class="error-message"></div>
    </section>

    <!-- STEP 4 -->
    <section class="box" id="step4">
      <h2 class="box-title">Bravo pour ton impro !</h2>
      <button id="download-video-btn" class="action-square animated-border">1) Télécharger la vidéo</button>
      <div id="contact-btn" class="action-square disabled">2) Se former avec un expert<br><div class="contact-options"><button id="contact-yes">Oui</button><button id="contact-no">Non</button></div></div>
      <button id="feedback-btn" class="action-square disabled">3) Analyser ma prestation</button>
    </section>

    <!-- STEP 5 -->
    <section class="box" id="step5">
      <h2 class="box-title">Réserve un appel avec nous</h2>
      <div class="calendly-inline-widget" data-url="https://calendly.com/letmotiv/premier-contact?hide_event_type_details=1" style="min-width:320px;height:900px"></div>
    </section>
  </div>

  <!-- FOOTER NAVIGATION -->
  <nav class="footer-nav" id="footer-nav"><button id="prev-btn">Précédent</button><button id="next-btn" disabled>Suivant</button></nav>
  <div id="global-share-btn"><i class="fas fa-share-alt"></i></div>

  <script src="https://assets.calendly.com/assets/external/widget.js" async></script>
  <script>
    /**** VARIABLES GLOBALES ****/
    const steps=[null,step1,step2,step3,step4,step5];
    const prevBtn=document.getElementById('prev-btn'),nextBtn=document.getElementById('next-btn');
    let currentStep=0,currentCategory=null,currentSubject="",isRecordingFinished=false,timerInt;

    /**** OUTILS UI ****/
    const progressBar=document.getElementById('progress-bar');
    const footerNav=document.getElementById('footer-nav');
    const enableNext=()=>{nextBtn.disabled=false;nextBtn.classList.add('pulse')};
    const disableNext=()=>{nextBtn.disabled=true;nextBtn.classList.remove('pulse')};
    const updateFooter=()=>{footerNav.style.display=currentStep?"flex":"none";prevBtn.disabled=currentStep===1};
    const goTo=idx=>{if(!steps[idx])return;steps[currentStep]?.classList.remove('active');steps[idx].classList.add('active','slide-from-bottom');currentStep=idx;progressBar.style.width=idx>=4?'100%':`${idx/5*100}%`;updateFooter();checkValid()};

    /**** INTRO ****/
    document.getElementById('start-intro-btn').onclick=()=>{document.getElementById('intro-box').style.display='none';goTo(1)};

    /**** DONNÉES OBJECTIFS & SUJETS ****/
    const objectives=[
      {cat:'diction',icon:'fa-grin-tongue',label:'Améliorer sa diction'},
      {cat:'repartie',icon:'fa-comments',label:'Avoir de la répartie'},
      {cat:'convaincre',icon:'fa-handshake',label:'Convaincre'},
      {cat:'conflit',icon:'fa-exclamation-triangle',label:'Gérer un conflit'},
      {cat:'inspirer',icon:'fa-lightbulb',label:'Inspirer'},
      {cat:'lacher-prise',icon:'fa-smile',label:'Lâcher prise'},
      {cat:'toast',icon:'fa-glass-cheers',label:'Porter un toast'},
      {cat:'entretien',icon:'fa-briefcase',label:'Réussir son entretien'},
      {cat:'vendre',icon:'fa-money-bill-wave',label:'Vendre'}
    ];
    const objectivesDiv=document.getElementById('objectives');
    objectives.forEach(o=>{
      const div=document.createElement('div');div.className='objective-item';div.dataset.category=o.cat;div.innerHTML=`<i class="fas ${o.icon}"></i><span>${o.label}</span>`;
      div.onclick=()=>{document.querySelectorAll('.objective-item').forEach(el=>el.classList.remove('selected-objective'));div.classList.add('selected-objective');currentCategory=o.cat;currentSubject="";document.getElementById('objective-error').textContent="";checkValid()};
      objectivesDiv.appendChild(div);
    });

    const subjectsCache={};const txtBase='https://raw.githubusercontent.com/Citizen11bf/letmotiv/data/';
    async function loadSubjects(cat){if(subjectsCache[cat])return subjectsCache[cat];const res=await fetch(txtBase+cat.replace('lacher-prise','lacher_prise')+'.txt');const txt=await res.text();subjectsCache[cat]=txt.split('\n').filter(l=>l.trim());return subjectsCache[cat];}

    /**** STEP 2 : génération sujet ****/
    const subjectWrapper=document.getElementById('subject-wrapper'),subjectDisplay=document.getElementById('subject-display');
    document.getElementById('generate-subject-btn').onclick=async()=>{
      if(!currentCategory){document.getElementById('objective-error').textContent='Choisis un objectif';return;}
      const list=await loadSubjects(currentCategory);currentSubject=list[Math.floor(Math.random()*list.length)];subjectDisplay.textContent=currentSubject;subjectWrapper.style.display='block';checkValid();};

    /**** STEP 3 : enregistrement vidéo ****/
    const preview=document.getElementById('preview');let mediaRec,recordedChunks=[];const countdownEl=document.getElementById('countdown');
    document.getElementById('start-btn').onclick=startVideo;
    async function startVideo(){if(!currentSubject){document.getElementById('subject-error').textContent='Génère un sujet avant';return;}
      const stream=await navigator.mediaDevices.getUserMedia({video:true,audio:true});preview.srcObject=stream;mediaRec=new MediaRecorder(stream);mediaRec.ondataavailable=e=>e.data.size&&recordedChunks.push(e.data);mediaRec.onstop=finishVideo;recordedChunks=[];isRecordingFinished=false;document.getElementById('video-overlay').style.display='none';document.getElementById('recording-indicator').style.display='flex';let secs=120;countdownEl.textContent='2:00';timerInt=setInterval(()=>{secs--;countdownEl.textContent=`${Math.floor(secs/60)}:${('0'+secs%60).slice(-2)}`;if(secs<=0){clearInterval(timerInt);mediaRec.stop();}},1000);mediaRec.start();disableNext();}
    function finishVideo(){clearInterval(timerInt);document.getElementById('recording-indicator').style.display='none';isRecordingFinished=true;checkValid();}

    /**** FOOTER NAV CLICK ****/
    nextBtn.onclick=()=>{if(nextBtn.disabled)return;goTo(currentStep+1)};prevBtn.onclick=()=>{if(prevBtn.disabled)return;goTo(currentStep-1)};

    function checkValid(){let ok=false;switch(currentStep){case 1:ok=!!currentCategory;break;case 2:ok=!!currentSubject;break;case 3:ok=isRecordingFinished;break;default:ok=false;}ok?enableNext():disableNext();}
    const enableNext=()=>{nextBtn.disabled=false;nextBtn.classList.add('pulse')};const disableNext=()=>{nextBtn.disabled=true;nextBtn.classList.remove('pulse')};

    /**** SHARE ****/
    document.getElementById('global-share-btn').onclick=()=>{if(navigator.share)navigator.share({title:'Simulateur Letmotiv',text:'Teste ton impro',url:location.href})};

    /* init */
    const progressInit=()=>{if(location.hash){const n=parseInt(location.hash.replace('#step',''));if(n)goTo(n)}};window.onload=progressInit;
  </script>
</body>
</html>
