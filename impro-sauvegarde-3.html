<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Simulateur d'improvisation</title>
  <style>
    :root{--primary:#182d84;--secondary:#00a48a;--accent:#FF5722;--dark:#333;}
    *{box-sizing:border-box;margin:0;padding:0;}
    body{font-family:'DM Sans',sans-serif;background:#fff;color:var(--dark);padding-top:60px;display:flex;justify-content:center;}
    .header{position:fixed;top:0;left:0;width:100%;background:var(--primary);color:#fff;text-align:center;padding:10px;font-weight:bold;}
    .progress{position:fixed;top:60px;left:0;width:100%;height:6px;background:rgba(0,0,0,0.1);}
    .progress .bar{width:0;height:100%;background:var(--secondary);transition:width .3s;}
    .container{width:100%;max-width:600px;padding:20px;}
    .intro,.box{display:none;}
    .active{display:block;}
    h1,h2{margin-bottom:20px;text-align:center;color:var(--primary);}
    .btn{display:inline-block;padding:12px 24px;border:none;border-radius:6px;font-size:16px;cursor:pointer;transition:transform .2s;}
    .btn-primary{background:var(--accent);color:#fff;}
    .btn-primary:hover{transform:scale(1.05);}
    .btn-secondary{background:var(--secondary);color:#fff;}
    .btn-secondary:hover{transform:scale(1.05);}
    .objectives{display:grid;grid-template-columns:repeat(auto-fit,minmax(100px,1fr));gap:10px;margin:20px 0;}
    .item{border:1px solid transparent;border-radius:8px;padding:12px;text-align:center;cursor:pointer;transition:.3s;}
    .item.selected{border-color:var(--secondary);background:rgba(0,164,138,0.1);}
    .item i{font-size:1.5rem;margin-bottom:8px;color:var(--primary);}
    #subject{margin:20px 0;padding:15px;background:var(--secondary);color:#fff;border-radius:6px;text-align:center;display:none;}
    .video-box{position:relative;width:100%;height:300px;border:2px solid var(--primary);border-radius:6px;overflow:hidden;background:#000;margin:20px 0;}
    .video-box video{width:100%;height:100%;object-fit:cover;transform:scaleX(-1);}
    .overlay{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;background:rgba(255,255,255,0.6);color:#555;}
    .recording{position:absolute;top:10px;right:10px;background:rgba(128,128,128,0.6);padding:5px 10px;border-radius:20px;display:flex;gap:5px;color:red;}
    .recording .dot{width:10px;height:10px;background:red;border-radius:50%;animation:blink 1s infinite;}
    @keyframes blink{0%,100%{opacity:1;}50%{opacity:0;}}
    .countdown{font-weight:bold;color:#fff;}
    .error{color:red;font-size:14px;margin-top:10px;text-align:center;}
  </style>
</head>
<body>
  <div class="header">Simulateur d'improvisation Letmotiv</div>
  <div class="progress"><div class="bar"></div></div>
  <div class="container">

    <!-- Intro -->
    <div class="intro active" id="intro">
      <h1>ENTRA√éNE-TOI √Ä LA PRISE DE PAROLE</h1>
      <button id="start" class="btn btn-primary">Commencer</button>
    </div>

    <!-- Step 1 -->
    <div class="box" id="step1">
      <h2>Choisis ton objectif</h2>
      <div id="objectives" class="objectives"></div>
      <div id="error1" class="error"></div>
      <button id="next1" class="btn btn-secondary">Suivant</button>
    </div>

    <!-- Step 2 -->
    <div class="box" id="step2">
      <h2>G√©n√®re un sujet</h2>
      <button id="gen" class="btn btn-secondary">G√©n√©rer sujet</button>
      <div id="subject"></div>
      <div id="error2" class="error"></div>
      <button id="next2" class="btn btn-secondary">Suivant</button>
    </div>

    <!-- Step 3 -->
    <div class="box" id="step3">
      <h2>Enregistre ta vid√©o</h2>
      <div id="subject-display" style="text-align:center;margin-bottom:10px;"></div>
      <div class="video-box">
        <video id="preview" autoplay muted playsinline></video>
        <div class="overlay" id="video-overlay">
          <p>Ta vid√©o sera enregistr√©e ici</p>
          <button id="start-impro" class="btn btn-secondary">D√©marrer</button>
        </div>
        <div class="recording" id="recording" style="display:none;"><span class="dot"></span><span class="countdown" id="timer">2:00</span></div>
      </div>
      <div id="error3" class="error"></div>
      <button id="next3" class="btn btn-secondary">Suivant</button>
    </div>

  <!-- Step 4 -->
    <div class="box" id="step4">
      <div class="box-header">
        <button class="back-btn" id="back-btn4" aria-label="Retour √† l'√©tape pr√©c√©dente">
          <i class="fas fa-arrow-up"></i>
        </button>
        <div class="box-title">F√©licitations pour ton improvisation ! ü§©</div>
      </div>
      <div class="download-section">
        <div class="action-container">
          <!-- Bouton 1 : T√©l√©charge ta vid√©o -->
          <button id="download-video-btn" class="action-square btn-action animated-border" aria-label="T√©l√©charge ta vid√©o">
            1) Je t√©l√©charge ma vid√©o
          </button>
          <!-- Bouton 2 : Rendez-vous avec un expert -->
          <div id="contact-btn" class="action-square contact-square disabled" aria-label="Prendre rdv avec un expert">
            <span>2) Je veux me former avec un expert</span>
            <div class="contact-options">
              <button id="contact-yes">Oui <span>‚úì</span></button>
              <button id="contact-no">Non <span>‚úó</span></button>
            </div>
          </div>
          <!-- Bouton 3 : Analyse ta prestation -->
          <button id="feedback-btn" class="action-square btn-action disabled" aria-label="Analyse ta prestation">
            3) J'analyse mon improvisation
          </button>
        </div>
        <!-- Section Newsletter -->
        <div class="newsletter-container">
          <h2 class="newsletter-title">Inscris-toi √† la newsletter Letmotiv <br>pour prendre la parole avec impact :</h2>
          <form id="newsletter-form" class="newsletter-form">
            <input type="text" id="newsletter-prenom" placeholder="Pr√©nom" aria-label="Pr√©nom">
            <div id="newsletter-prenom-error" class="newsletter-error"></div>
            <input type="email" id="newsletter-email" placeholder="Email" aria-label="Email">
            <div id="newsletter-email-error" class="newsletter-error"></div>
            <button type="submit" id="newsletter-submit-btn" class="btn-newsletter">S'abonner</button>
          </form>
          <div id="newsletter-success" class="newsletter-success" style="display: none;">Tu es maintenant abonn√© √† la newsletter Letmotiv.</div>
        </div>
      </div>
    </div>

    <!-- Step 5 -->
    <div class="box" id="step5">
      <div class="box-header">
        <button class="back-btn" id="back-btn5" aria-label="Retour √† l'√©tape pr√©c√©dente">
          <i class="fas fa-arrow-up"></i>
        </button>
        <div class="box-title">Planifiez un appel avec nous</div>
      </div>
      <main>
        <section id="calendy" class="section calendy">
          <div class="container">
            <div class="calendly-inline-widget" data-url="https://calendly.com/letmotiv/premier-contact?hide_event_type_details=1" style="min-width:320px;height:1000px;"></div>
          </div>
        </section>
      </main>
    </div>  
  </div> 
  </div>

  <script>
    // Donn√©es
    const objectivesList=[
      {cat:'diction',label:'Am√©liorer sa diction',icon:'fa-grin-tongue'},
      {cat:'repartie',label:'Avoir de la r√©partie',icon:'fa-comments'},
      {cat:'convaincre',label:'Convaincre',icon:'fa-handshake'},
      {cat:'conflit',label:'G√©rer un conflit',icon:'fa-exclamation-triangle'},
      {cat:'inspirer',label:'Inspirer',icon:'fa-lightbulb'},
      {cat:'lacher-prise',label:'L√¢cher prise',icon:'fa-smile'},
      {cat:'toast',label:'Porter un toast',icon:'fa-glass-cheers'},
      {cat:'entretien',label:'R√©ussir son entretien',icon:'fa-briefcase'},
      {cat:'vendre',label:'Vendre',icon:'fa-money-bill-wave'}
    ];
    const txtFiles={
      convaincre:'data/convaincre.txt',inspirer:'data/inspirer.txt','lacher-prise':'data/lacher_prise.txt',
      toast:'data/toast.txt',repartie:'data/repartie.txt',vendre:'data/vendre.txt',
      conflit:'data/gerer_un_conflit.txt',diction:'data/diction.txt',entretien:'data/entretien.txt'
    };
    let subjectsCache={},currentCat='',currentSubject='';

    // Affichage
    const bar=document.querySelector('.bar');
    const steps=['intro','step1','step2','step3']; let step=0;
    function show(n){
      document.getElementById(steps[step]).classList.remove('active');
      document.getElementById(steps[n]).classList.add('active');
      bar.style.width=(n/(steps.length-1)*100)+'%'; step=n;
    }

    // Init objectives
    function renderObjectives(){
      const cont=document.getElementById('objectives');
      objectivesList.forEach(o=>{
        let d=document.createElement('div'); d.className='item'; d.dataset.cat=o.cat;
        d.innerHTML=`<i class="fas ${o.icon}"></i><span>${o.label}</span>`;
        d.onclick=()=>{document.querySelectorAll('.item').forEach(x=>x.classList.remove('selected'));d.classList.add('selected');currentCat=o.cat;};
        cont.append(d);
      });
    }

    // Chargement sujets
    async function loadSubjects(cat){if(subjectsCache[cat])return subjectsCache[cat];
      try{let txt=await fetch(txtFiles[cat]).then(r=>r.text());
        return subjectsCache[cat]=txt.split('\n').map(l=>l.trim()).filter(l=>l);
      }catch{return subjectsCache[cat]=[];}}

    // S√©lecteurs
    document.getElementById('start').onclick=()=>show(1);
    document.getElementById('next1').onclick=()=>{
      if(!currentCat)return document.getElementById('error1').textContent='S√©lectionne un objectif';
      document.getElementById('error1').textContent=''; show(2);
    };
    document.getElementById('gen').onclick=async()=>{
      if(!currentCat)return document.getElementById('error2').textContent='Choisis un objectif';
      let s=await loadSubjects(currentCat);
      if(!s.length)return document.getElementById('subject').textContent='Pas de sujet dispo';
      currentSubject=s[Math.floor(Math.random()*s.length)];
      document.getElementById('subject').textContent=currentSubject;
      document.getElementById('subject').style.display='block';
      document.getElementById('error2').textContent='';
    };
    document.getElementById('next2').onclick=()=>{
      if(!currentSubject)return document.getElementById('error2').textContent='G√©n√®re un sujet';
      document.getElementById('subject-display').textContent=currentSubject;
      show(3);
    };

    // Enregistrement vid√©o
    let recorder,chunks=[];
    document.getElementById('start-impro').onclick=async()=>{
      if(!currentSubject)return document.getElementById('error3').textContent='G√©n√®re un sujet';
      let stream=await navigator.mediaDevices.getUserMedia({video:true,audio:true});
      document.getElementById('preview').srcObject=stream;
      recorder=new MediaRecorder(stream);
      recorder.ondataavailable=e=>chunks.push(e.data);
      recorder.onstop=()=>{stream.getTracks().forEach(t=>t.stop());};
      recorder.start(); document.getElementById('video-overlay').style.display='none';
      document.getElementById('recording').style.display='flex'; startTimer();
    };
    function startTimer(){let t=120,el=document.getElementById('timer');
      let iv=setInterval(()=>{t--;el.textContent=`${Math.floor(t/60)}:${t%60<10?'0'+t%60:t%60}`;
        if(t<0){clearInterval(iv);recorder.stop(); document.getElementById('recording').style.display='none';}
      },1000);
    }

    // Initialisation
    renderObjectives();
  </script>
</body>
</html>
