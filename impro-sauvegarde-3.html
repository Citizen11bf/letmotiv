<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Simulateur d'improvisation</title>
  <link rel="icon" href="https://raw.githubusercontent.com/Citizen11bf/letmotiv/refs/heads/images/Letmotiv_favicon.webp" type="image/png">
  <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/Citizen11bf/letmotiv/refs/heads/images/Letmotiv_favicon.webp">
  <style>
    /* GLOBAL */
    * { box-sizing: border-box; }
    body { margin: 0; font-family: 'DM Sans', sans-serif; background: #fff; color: #333; padding-top: 60px; padding-bottom: 60px; }
    /* HEADER */
    .header { position: fixed; top: 0; left: 0; width: 100%; background: #182d84; color: #fff; text-align: center; padding: 10px; z-index: 10; }
    /* PROGRESS BAR DASHED */
    .progress-container { position: fixed; top: 60px; left: 0; width: 100%; height: 8px; background: rgba(24,45,132,0.1);
      background-image: repeating-linear-gradient(to right, transparent 0%, transparent 19%, rgba(24,45,132,0.1) 19%, rgba(24,45,132,0.1) 20%);
      z-index: 9;
    }
    .progress-bar { width: 0%; height: 100%; background-image: repeating-linear-gradient(to right, #00a48a 0%, #00a48a 19%, transparent 19%, transparent 20%);
      background-size: 20% 100%; transition: width 0.5s ease;
    }
    /* BOXES */
    .box { display: none; padding: 20px; max-width: 600px; margin: 80px auto 0; background: #f9f9f9; border-radius: 12px; }
    .box.active { display: block; }
    .box-title { font-size: 16px; font-weight: bold; color: #182d84; text-align: center; margin-bottom: 20px; }
    /* OBJECTIVES */
    .objectives-container { display: flex; flex-wrap: wrap; gap: 15px; justify-content: center; }
    .objective-item { flex: 1 1 150px; background: #f7f9fc; border-radius: 8px; padding: 12px; text-align: center; cursor: pointer; transition: transform 0.2s, background 0.2s; }
    .objective-item.selected-objective { background: rgba(0,164,138,0.2); border: 1px solid #00a48a; transform: scale(1.05); }
    /* SUBJECT */
    .btn-impro { background: #182d84; color: #fff; padding: 10px 20px; border: none; border-radius: 25px; cursor: pointer; }
    #subject-wrapper { display: none; margin-top: 20px; background: linear-gradient(135deg,#00a48a,#182d84); color: #fff; padding: 15px; border-radius: 8px; }
    /* VIDEO STEP */
    .video-box { position: relative; margin: 20px auto; border: 3px solid #182d84; border-radius: 6px; max-width: 500px; height: 300px; background: #fff; }
    .video-overlay { position: absolute; width: 100%; height: 100%; background: rgba(255,255,255,0.6); display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; }
    .recording-indicator { display: none; position: absolute; top: 10px; right: 10px; background: rgba(128,128,128,0.6); padding: 5px 10px; border-radius: 20px; color: #f00; font-size: 14px; }
    .dot { width: 10px; height: 10px; background: #f00; border-radius: 50%; animation: blink 1s infinite; }
    @keyframes blink { 0%,100%{opacity:1;}50%{opacity:0;} }
    /* FOOTER NAV */
    footer#footer-nav { position: fixed; bottom: 0; left: 0; width: 100%; padding: 10px; background: #fff; box-shadow: 0 -2px 6px rgba(0,0,0,0.1); display: flex; justify-content: center; }
    #footer-next { background: #00a48a; color: #fff; border: none; padding: 12px 30px; border-radius: 8px; font-size: 16px; cursor: pointer; width: 90%; max-width: 400px; }
    #footer-next:disabled { background: #ccc; cursor: not-allowed; }
    /* RESPONSIVE */
    @media(max-width:600px){ footer#footer-nav{padding:8px;} #footer-next{width:95%;} }
  </style>
</head>
<body>
  <div class="header">
    <div>Coaching en prise de parole — Simulateur Letmotiv</div>
  </div>
  <div class="progress-container"><div class="progress-bar" id="progress-bar"></div></div>
  <div class="main-container">
    <!-- STEP 1 -->
    <div class="box" id="step1">
      <div class="box-title">Quel est ton objectif ?</div>
      <div class="objectives-container">
        <div class="objective-item" data-category="diction">Améliorer sa diction</div>
        <div class="objective-item" data-category="repartie">Avoir de la répartie</div>
        <div class="objective-item" data-category="convaincre">Convaincre</div>
        <div class="objective-item" data-category="inspirer">Inspirer</div>
        <div class="objective-item" data-category="toast">Porter un toast</div>
        <div class="objective-item" data-category="vendre">Vendre</div>
        <div class="objective-item" data-category="conflit">Gérer un conflit</div>
        <div class="objective-item" data-category="entretien">Réussir son entretien</div>
        <div class="objective-item" data-category="lacher-prise">Lâcher prise</div>
      </div>
    </div>
    <!-- STEP 2 -->
    <div class="box" id="step2">
      <div class="box-title">Prêt à relever le défi ?</div>
      <button class="btn-impro" id="generate-subject-btn">Générer un sujet</button>
      <div id="subject-wrapper"><span id="subject-display"></span></div>
    </div>
    <!-- STEP 3 -->
    <div class="box" id="step3">
      <div class="box-title">C'est parti, lance ton improvisation !</div>
      <div class="video-box">
        <video id="preview" autoplay muted playsinline style="width:100%;height:100%;object-fit:cover;transform:scaleX(-1);"></video>
        <div class="video-overlay" id="video-overlay">
          <p>Ta vidéo va s'enregistrer ici.</p>
          <button id="start-btn" class="btn-impro">Démarrer l'impro</button>
          <p>NB : ta vidéo reste sur ton appareil.</p>
        </div>
        <div class="recording-indicator" id="recording-indicator">
          <span class="dot"></span> <span id="countdown">2:00</span>
        </div>
      </div>
    </div>
    <!-- STEP 4 -->
    <div class="box" id="step4">
      <div class="box-title">Félicitations pour ton improvisation !</div>
      <button id="download-video-btn" class="btn-impro">1) Télécharger la vidéo</button>
      <div style="margin-top:15px;">
        <button id="contact-yes" class="btn-impro">2) Prendre rdv avec un expert</button>
        <button id="contact-no" class="btn-impro">Pas pour moi</button>
      </div>
    </div>
    <!-- STEP 5 -->
    <div class="box" id="step5">
      <div class="box-title">Planifie un appel avec nous</div>
      <div class="calendly-inline-widget" data-url="https://calendly.com/letmotiv/premier-contact" style="min-width:320px;height:800px;"></div>
    </div>
  </div>
  <!-- FOOTER NAV -->
  <footer id="footer-nav"><button id="footer-next" disabled>Suivant</button></footer>
  <script>
    // Variables
    const boxes = [...document.querySelectorAll('.box')];
    const footerNext = document.getElementById('footer-next');
    const progressBar = document.getElementById('progress-bar');
    let step = 1;
    let currentCategory = null;
    let currentSubject = '';
    let hasRecording = false;

    // Show a given step
    function showStep(n) {
      boxes.forEach(b => b.classList.remove('active'));
      document.getElementById('step'+n).classList.add('active');
      step = n;
      updateProgress();
      updateFooter();
    }

    // Update dashed progress
    function updateProgress() {
      const pct = ((step-1)/(boxes.length-1))*100;
      progressBar.style.width = pct+'%';
    }

    // Enable footer if conditions met
    function updateFooter() {
      let ok = false;
      if(step===1) ok = !!currentCategory;
      if(step===2) ok = !!currentSubject;
      if(step===3) ok = hasRecording;
      if(step===4) ok = document.querySelector('#contact-yes.clicked') || document.querySelector('#contact-no.clicked');
      if(step>=5) ok = false;
      footerNext.disabled = !ok;
    }

    // Advance
    footerNext.addEventListener('click', ()=>{
      if(step===1) showStep(2);
      else if(step===2) showStep(3);
      else if(step===3) showStep(4);
      else if(step===4) showStep(5);
    });

    // STEP1: objectives
    document.querySelectorAll('.objective-item').forEach(el=>{
      el.addEventListener('click', ()=>{
        document.querySelectorAll('.objective-item').forEach(e=>e.classList.remove('selected-objective'));
        el.classList.add('selected-objective');
        currentCategory = el.dataset.category;
        updateFooter();
      });
    });

    // STEP2: subject
    document.getElementById('generate-subject-btn').addEventListener('click', async ()=>{
      // load + pick random from cache
      const urlMap = {
        convaincre:'.../convaincre.txt', inspirer:'.../inspirer.txt', repartie:'.../repartie.txt', diction:'.../diction.txt', entretien:'.../entretien.txt', toast:'.../toast.txt', vendre:'.../vendre.txt', conflit:'.../gerer_un_conflit.txt', 'lacher-prise':'.../lacher_prise.txt'
      };
      const txt = await fetch(urlMap[currentCategory]).then(r=>r.text());
      const arr=txt.split('\n').filter(l=>l.trim());
      currentSubject=arr[Math.floor(Math.random()*arr.length)];
      document.getElementById('subject-display').textContent=currentSubject;
      document.getElementById('subject-wrapper').style.display='block';
      updateFooter();
    });

    // STEP3: recording
    let recorder, stream;
    document.getElementById('start-btn').addEventListener('click', async ()=>{
      stream = await navigator.mediaDevices.getUserMedia({video:true,audio:true});
      document.getElementById('preview').srcObject = stream;
      recorder = new MediaRecorder(stream);
      let chunks=[];
      recorder.ondataavailable=e=>chunks.push(e.data);
      recorder.onstop=()=>{ hasRecording=true; updateFooter(); stream.getTracks().forEach(t=>t.stop()); };
      recorder.start();
      document.getElementById('recording-indicator').style.display='flex';
      setTimeout(()=>recorder.stop(),120000);
    });

    // STEP4: contact
    ['contact-yes','contact-no'].forEach(id=>{
      document.getElementById(id).addEventListener('click', ()=>{
        document.getElementById(id).classList.add('clicked');
        updateFooter();
      });
    });

    // Init
    showStep(1);
  </script>
</body>
</html>
